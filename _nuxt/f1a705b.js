(window.webpackJsonp=window.webpackJsonp||[]).push([[9,12],{198:function(e,t,n){"use strict";n.r(t);var r={data:function(){return{headerOverlay:!1,head:{title:"",description:""}}},watch:{headerOverlay:function(e,t){this.$root.$emit("headerOverlay",e)}},mounted:function(){this.$root.$emit("headerOverlay",this.headerOverlay)},head:function(){return{title:this.head.title,meta:[{hid:"description",name:"description",content:this.head.description}]}}},o=n(4),component=Object(o.a)(r,(function(){var e=this.$createElement;return(this._self._c||e)("div")}),[],!1,null,null,null);t.default=component.exports},225:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));n(226);var r=n(97),o=n(98),c=n(241),l=n(242),d=n(228),h=n(199);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=f(n);function n(e,o){var c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(r.a)(this,n),(c=t.call(this,e,"./oceanPostProcess",["time","fov","resolution","cameraPosition","cameraRotation","worldScale"],["positionSampler","reflectionSampler","refractionSampler","skyTexture"],{width:l.width||o.getEngine().getRenderWidth(),height:l.height||o.getEngine().getRenderHeight()},l.isPipeline?null:o,h.Texture.TRILINEAR_SAMPLINGMODE,o.getEngine(),!0))._time=0,c.worldScale=1,c._cameraRotation=h.Vector3.Zero(),c._cameraViewMatrix=h.Matrix.Identity(),c._reflectionEnabled=!1,c._refractionEnabled=!1,c._skyTexture=null,c._camera=o,c._options=l,c.reflectionTexture=null,c.refractionTexture=null,c._geometryRenderer=o.getScene().enableGeometryBufferRenderer(1),c._geometryRenderer&&c._geometryRenderer.isSupported?c._geometryRenderer.enablePosition=!0:c.updateEffect("#define NOT_SUPPORTED\n"),c.onApply=function(e){if(c._geometryRenderer&&c._geometryRenderer.isSupported){var t=o.getEngine(),n=o.getScene();c._time+=.001*t.getDeltaTime(),e.setFloat("time",c._time);e.setVector2("resolution",new h.Vector2(t.getRenderWidth()/1,t.getRenderHeight()/1)),n&&(e.setVector3("cameraPosition",o.globalPosition),c._computeCameraRotation(o),e.setVector3("cameraRotation",c._cameraRotation),e.setFloat("fov",o.fov),e.setFloat("worldScale",c.worldScale),e.setTexture("positionSampler",c._geometryRenderer.getGBuffer().textures[2]),c._reflectionEnabled&&e.setTexture("reflectionSampler",c.reflectionTexture),c._refractionEnabled&&e.setTexture("refractionSampler",c.refractionTexture),c._skyTexture&&e.setTexture("skyTexture",c._skyTexture))}},c}return Object(o.a)(n,[{key:"reflectionEnabled",get:function(){return this._reflectionEnabled},set:function(e){if(this._reflectionEnabled!==e){this._reflectionEnabled=e,e&&!this.reflectionTexture&&(this.reflectionTexture=new h.MirrorTexture("oceanPostProcessReflection",this._options.reflectionSize||{width:512,height:512},this._camera.getScene()),this.reflectionTexture.mirrorPlane=h.Plane.FromPositionAndNormal(h.Vector3.Zero(),new h.Vector3(0,-1,0))),this.updateEffect(this._getDefines());var t=this.getCamera().getScene().customRenderTargets;if(e)t.push(this.reflectionTexture);else{var n=t.indexOf(this.reflectionTexture);-1!==n&&t.splice(n,1)}}}},{key:"refractionEnabled",get:function(){return this._refractionEnabled},set:function(e){if(this._refractionEnabled!==e){this._refractionEnabled=e,e&&!this.refractionTexture&&(this.refractionTexture=new h.RenderTargetTexture("oceanPostProcessRefraction",this._options.refractionSize||{width:512,height:512},this._camera.getScene())),this.updateEffect(this._getDefines());var t=this.getCamera().getScene().customRenderTargets;if(e)t.push(this.refractionTexture);else{var n=t.indexOf(this.refractionTexture);-1!==n&&t.splice(n,1)}}}},{key:"skyTexture",set:function(e){this._skyTexture=e,this.updateEffect(this._getDefines())}},{key:"isSupported",get:function(){return null!==this._geometryRenderer&&this._geometryRenderer.isSupported}},{key:"_getDefines",value:function(){var e=[];return this._reflectionEnabled&&e.push("#define REFLECTION_ENABLED"),this._refractionEnabled&&e.push("#define REFRACTION_ENABLED"),this._skyTexture&&e.push("#define SKY_ENABLED"),e.join("\n")}},{key:"_computeCameraRotation",value:function(e){e.upVector.normalize();var t=e.getTarget();e._initialFocalDistance=t.subtract(e.position).length(),e.position.z===t.z&&(e.position.z+=h.Epsilon);var n=t.subtract(e.position);e._viewMatrix.invertToRef(this._cameraViewMatrix),this._cameraRotation.x=Math.atan(this._cameraViewMatrix.m[6]/this._cameraViewMatrix.m[10]),n.x>=0?this._cameraRotation.y=-Math.atan(n.z/n.x)+Math.PI/2:this._cameraRotation.y=-Math.atan(n.z/n.x)-Math.PI/2,this._cameraRotation.z=0,isNaN(this._cameraRotation.x)&&(this._cameraRotation.x=0),isNaN(this._cameraRotation.y)&&(this._cameraRotation.y=0),isNaN(this._cameraRotation.z)&&(this._cameraRotation.z=0)}}]),n}(h.PostProcess)},226:function(e,t,n){var r=n(2),o=n(68),c=n(54),l=n(7),d=n(12),h=n(8),f=n(227),m=(n(5).Reflect||{}).construct,v=h((function(){function e(){}return!(m((function(){}),[],e)instanceof e)})),y=!h((function(){m((function(){}))}));r(r.S+r.F*(v||y),"Reflect",{construct:function(e,t){c(e),l(t);var n=arguments.length<3?e:c(arguments[2]);if(y&&!v)return m(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(f.apply(e,r))}var h=n.prototype,w=o(d(h)?h:Object.prototype),x=Function.apply.call(e,w,t);return d(x)?x:w}})},227:function(e,t,n){"use strict";var r=n(54),o=n(12),c=n(139),l=[].slice,d={},h=function(e,t,n){if(!(t in d)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";d[t]=Function("F,a","return new F("+r.join(",")+")")}return d[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=l.call(arguments,1),d=function(){var r=n.concat(l.call(arguments));return this instanceof d?h(t,r.length,r):c(t,r,e)};return o(t.prototype)&&(d.prototype=t.prototype),d}},228:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,"a",(function(){return r}))},241:function(e,t,n){"use strict";function r(e,p){return r=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e},r(e,p)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,"a",(function(){return o}))},242:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(17);function o(e,t){return!t||"object"!==Object(r.a)(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}},251:function(e,t,n){"use strict";n.r(t),t.default="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform mat4 worldViewProjection;\nuniform vec2 cameraMinMaxZ;\n\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n// varying float normalizedDepth;\n\n#include<bonesDeclaration>\n#include<instancesDeclaration>\n\n/*\n * Vertex shader for caustic and babylonjs.\n */\nvoid main() {\n    vec3 positionUpdated = position;\n\n    // include shaders to calculate instances and bones\n    #include<instancesVertex>\n    #include<bonesVertex>\n\n    // return normal, uv and position\n    vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);\n    vec4 viewPos = view * worldPos;\n\n    // float distancetoCamera = -viewPos.z;\n    // float distance = (cameraMinMaxZ.x + (cameraMinMaxZ.y - cameraMinMaxZ.x)*depth);\n    // float normalizedDistance = distance / cameraMinMaxZ.x;\n    // normalizedDepth = (distancetoCamera - cameraMinMaxZ.x)/(cameraMinMaxZ.y - cameraMinMaxZ.x);\n\n    vNormal = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n    vPosition = worldPos.xyz;\n    vUV = uv;\n\n    gl_Position = projection * viewPos;\n}\n"},252:function(e,t,n){var content=n(333);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(28).default)("defcfe60",content,!0,{sourceMap:!1})},328:function(e,t,n){"use strict";n.r(t),t.default="precision highp float;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 worldViewProjection;\n\nvarying vec2 vUV;\n\nvoid main() {\n  vUV = uv;\n  gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n"},329:function(e,t,n){"use strict";n.r(t),t.default="precision highp float;\n\nvarying vec2 vUV;\n\nuniform float time;\nuniform vec3 fogColor;\nuniform vec2 cameraMinMaxZ;\nuniform vec3 cameraPosition;\n\nuniform sampler2D textureSampler; // rendered buffer\nuniform sampler2D causticTexture; // multipass caustic texture\nuniform sampler2D depthTexture; // z-depth map for rendered buffer\nuniform sampler2D oceanDepthTexture; // z-depth map for ocean pass\nuniform sampler2D skyTexture; // the spherical sky texture\n\n\n#define csb(f, con, sat, bri) mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), f*bri)), f*bri, sat), con)\n\n#define TAU 6.28318530718\n#define MAX_ITER 8\n#define BASE_INTEN .005\n#define FOG_DENSITY 2.8\n#define FOG_DISTANCE_CORRECTION 6.0 // move the far plane closer\n#define SEA_BASE_COLOR vec3(0.0, 0.176, 0.333)\n\nfloat fogFactorExp(\n  const float dist,\n  const float density\n) {\n  return 1.0 - clamp(exp2(-density * dist), 0.0, 1.0);\n}\n\nfloat causticX(float x, float power, float gtime)\n{\n  float p = mod(x*TAU, TAU)-250.0;\n  float tTime = gtime * .5+23.0;\n\n\tfloat i = p;\n\tfloat c = 1.0;\n\tfloat inten = BASE_INTEN;\n\n\tfor (int n = 0; n < MAX_ITER/2; n++)\n\t{\n\t\tfloat t = tTime * (1.0 - (3.5 / float(n+1)));\n\t\ti = p + cos(t - i) + sin(t + i);\n\t\tc += 1.0/length(p / (sin(i+t)/inten));\n\t}\n\tc /= float(MAX_ITER);\n\tc = 1.17-pow(c, power);\n\n    return c;\n}\n\nfloat godRaysCalc(vec2 uv)\n{\n    float light = 0.0;\n\n    light += pow(causticX((uv.x+0.08*uv.y)/1.7+0.5, 1.8, time*0.65),10.0)*0.05;\n    light -= pow((1.0-uv.y)*0.3,2.0)*0.2;\n    light += pow(causticX(sin(uv.x), 0.3,time*0.7),9.0)*0.4;\n    light += pow(causticX(cos(uv.x*2.3), 0.3,time*1.3),4.0)*0.1;\n\n    light -= pow((1.0-uv.y)*0.3,3.0);\n    light = clamp(light,0.0,1.0);\n\n    return light;\n}\n\nvoid main() {\n  // base texture\n  vec4 base = texture2D(textureSampler, vUV);\n\n  vec4 depthVec = texture2D(depthTexture, vUV);\n  float Zdepth = depthVec.r;\n\n  // no effect above water\n  if (cameraPosition.y >= 0.0) {\n    gl_FragColor.rgb = base.rgb;\n    gl_FragColor.w = 1.0;\n    return;\n  }\n\n  // apply visibility loss with distance\n  vec4 oceanDepthVec = texture2D(oceanDepthTexture, vUV);\n  float oceanZDepth = oceanDepthVec.r;\n\n  vec4 color;\n  if (oceanZDepth < Zdepth && oceanZDepth != 1.0) {\n    // if we have no fog, this smoothing of the horizon is required.\n\n    // const float MAX_Z_SMOOTH = 0.6;\n    // if (oceanZDepth / Zdepth > MAX_Z_SMOOTH) {\n    //   // smooth out large Z, so we have a pretty infinity\n    //   color.rgb = mix(fogColor, base.rgb, smoothstep(1.0, 0.0, oceanZDepth / Zdepth * MAX_Z_SMOOTH));\n    // }\n    // else {\n    //   // just the ocean, thanks\n    //   color.rgb = base.rgb;\n    // }\n    color.rgb = base.rgb;\n    Zdepth = oceanZDepth;\n  }\n  else {\n    // apply underwater effects\n\n    // god rays\n    vec3 skyColor = SEA_BASE_COLOR;\n    // TODO: godRays should take camera angle into consideration\n    vec3 godRays = 0.7*(godRaysCalc(vUV*2.)*mix(float(skyColor), 1.0, vUV.y*vUV.y) * vec3(0.7,1.0,1.0));\n\n    // TODO: noise\n    // TODO: color loss with depth\n    vec4 caustic = texture2D(causticTexture, vUV);\n\n    // color.rgb = base.rgb; // plain\n    // color.r = actualDepth.r; // plain\n    // color.rgb = caustic.rgb; // pure caustic\n    // color.rgb = godRays; // pure god rays\n    // color.rgb = vec3(distance, distance, distance); ; // just depth\n    // color.rgb = vec3(distance / cameraMinMaxZ.y, distance / cameraMinMaxZ.y, distance / cameraMinMaxZ.y); // normalized depth\n    color.rgb = mix(base.rgb, caustic.rgb, clamp(caustic.a * 0.5 * Zdepth, 0.2, 0.7)); // caustics + texture\n  }\n\n  // actual distance from the lens in scene units\n  float distance = (cameraMinMaxZ.x + (cameraMinMaxZ.y - cameraMinMaxZ.x)*Zdepth);\n  float normalizedDistance = distance / cameraMinMaxZ.y;\n  float fogFactor = clamp(\n    1.4 * fogFactorExp(normalizedDistance, FOG_DENSITY * FOG_DISTANCE_CORRECTION),\n    0.0,\n    1.0\n  );\n  // color.rgb = vec3(fogFactor, fogFactor, fogFactor); // pure fog\n  // color.rgb = mix(base.rgb, fogColor, fogFactor); // fog + texture\n  color.rgb = mix(\n    color.rgb,\n    fogColor,\n    fogFactor\n  ); // + godRays; // everything\n\n  // color, saturation, brightness\n  color.rgb = csb(color.rgb, 1.1, 1.05, 1.22);\n\n  // Vignette\n  // color.rgb = mix(color.rgb, vec3(.0), abs(vUV.x - 0.5)*abs(vUV.y * 2.0 - 1.0));\n\n  gl_FragColor.rgb = color.rgb;\n  gl_FragColor.w = 1.0; //base.w;\n}\n"},330:function(e,t,n){"use strict";n.r(t),t.default="#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define TAU 6.28318530718\n#define MAX_ITER 5\n#define SPEED 0.3\n#define SCALE 30.0\n\nuniform float time;\n\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvec4 caustic(vec2 uv) {\n  vec2 p = mod(uv*TAU, TAU)-250.0;\n  float t = time * SPEED + 23.0;\n\n  vec2 i = vec2(p);\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER; n++) {\n    float t = t * (1.0 - (3.5 / float(n+1)));\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\n  }\n\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, 1.4);\n  vec3 color = vec3(pow(abs(c), 8.0));\n  color = clamp(color + vec3(0.0, 0.0, 0.0), 0.0, 1.0);\n\n  float alpha=0.5;\n  float contrast=0.0;\n  color = mix(color, vec3(1.0,1.0,1.0),contrast);\n  //color.a = alpha;\n  vec4 color4 = vec4(color,0.0);\n\n  return color4;\n}\n\n/*\n * Fragment shader for caustic and babylonjs. Renders a fake caustic, using an\n * animated noise function and the world coordinates as UV.\n */\nvoid main(void)\n{\n  // TODO: y coordinate should multiply caustic to reduce light on higher ocean depths\n\n  vec2 coord = vec2(fract(vPosition.x/SCALE), fract(vPosition.z/SCALE));\n  if (vNormal.y > 0.0 && vPosition.y < 0.0) {\n    // scale by normal to make caustic less pronounced for more vertical faces.\n    gl_FragColor = clamp(caustic(coord), 0.0, 1.0) * vNormal.y;\n    gl_FragColor.a = 1.0;\n  }\n  else {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n  }\n}\n\n"},331:function(e,t,n){"use strict";n.r(t),t.default="#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform float time;\n\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\n/*\n * simple pure black shader for objects that should not render caustics.\n */\nvoid main(void)\n{\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n}\n\n"},332:function(e,t,n){"use strict";n(252)},333:function(e,t,n){var r=n(27)(!1);r.push([e.i,"#underwater[data-v-bc87a4d4]{height:100vh;width:100%;position:relative}#underwater-3d[data-v-bc87a4d4]{height:100vh;width:100vw}#underwater-debug[data-v-bc87a4d4]{top:0;right:0}#underwater-debug[data-v-bc87a4d4],#underwater-hud[data-v-bc87a4d4]{position:absolute;padding:10px;z-index:1000;border-radius:10px;background:#000;color:#fff;text-align:right}#underwater-hud[data-v-bc87a4d4]{bottom:0;left:0;width:160px;height:220px;font-family:monospace}#underwater-hud span[data-v-bc87a4d4]{display:inline-block}#underwater-hud #underwater-hud-compass[data-v-bc87a4d4],#underwater-hud #underwater-hud-time[data-v-bc87a4d4]{margin-top:10px}#underwater-hud #underwater-hud-compass-value[data-v-bc87a4d4],#underwater-hud #underwater-hud-depth-value[data-v-bc87a4d4],#underwater-hud #underwater-hud-time-value[data-v-bc87a4d4]{line-height:.9;font-size:42px;font-family:monospace}#underwater-hud #underwater-hud-depth-ascent[data-v-bc87a4d4]{-ms-writing-mode:tb-rl;writing-mode:vertical-rl}#underwater-hud #underwater-hud-compass-name[data-v-bc87a4d4],#underwater-hud #underwater-hud-depth-name[data-v-bc87a4d4],#underwater-hud #underwater-hud-time-name[data-v-bc87a4d4]{color:#4c70ff}#underwater-hud #underwater-hud-depth-unit[data-v-bc87a4d4],#underwater-hud #underwater-hud-time-unit[data-v-bc87a4d4]{vertical-align:top}#underwater-fullscreen[data-v-bc87a4d4]{position:absolute;top:20px;left:0;padding:20px;margin:0;z-index:1000;max-width:80%;line-height:1.2em;border-radius:10px;font-size:42px;background:#004;color:#fff;text-align:center}#underwater-settings[data-v-bc87a4d4]{position:absolute;bottom:0;right:0;padding:10px;z-index:1000;color:#fff;text-align:right}#underwater-settings svg[data-v-bc87a4d4]{cursor:pointer}",""]),e.exports=r},414:function(e,t,n){"use strict";n.r(t);var r=n(198),o=n(86);var c=n(117),l=n(64);function d(e){return function(e){if(Array.isArray(e))return Object(o.a)(e)}(e)||Object(c.a)(e)||Object(l.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=n(97),f=n(98),m=(n(37),n(15),n(38),n(35),n(40),n(29),n(39),n(70),n(71),n(248),n(21),n(36),n(199)),v=(n(209),n(225));function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var x=function(){function e(t,n,r){Object(h.a)(this,e),this.id=t,this.position=n,this.velocity=r,this.force=new BABYLON.Vector3(0,0,0)}return Object(f.a)(e,[{key:"orientation",get:function(){return this.velocity.normalize()}}]),e}(),M=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(h.a)(this,e),this.cohesion=.3,this.separation=.4,this.alignment=1,this.separationMinDistance=3,this.maxSpeed=1,this.boundsMin=new BABYLON.Vector3(n.x-o,n.y-o,n.z-o),this.boundsMax=new BABYLON.Vector3(n.x+o,n.y+o,n.z+o),this.otherForces=[],this.boids=[],this.debug={show:!1,influences:[],arrows:[]},c||(c=new BABYLON.Vector3(.3,.1,.3));var l=c.length();this.center=n.clone(),this.avgVel=new BABYLON.Vector3(0,0,0);for(var i=0;i<t;i++){var d=this.center.add(new BABYLON.Vector3((Math.random()-.5)*r,(Math.random()-.5)*r,(Math.random()-.5)*r)),f=new BABYLON.Vector3(c.x+(Math.random()-.5)/10*l,c.y+(Math.random()-.5)/10*l,c.z+(Math.random()-.5)/10*l),m=new x(i,d,f);this.boids.push(m)}}return Object(f.a)(e,[{key:"update",value:function(e){var t=this;this._updateCenter();var n=this.maxSpeed*this.maxSpeed;this.boids.forEach((function(r){var o=t._forceCentreMass(r),c=t._forceSeparation(r),l=t._forceMatchVelocity(r),d=t._forceBoundaries(r),h=o.add(c).add(l).add(d);t.otherForces.forEach((function(e){h.add(e(t,r))})),r.force.copyFrom(h),r.velocity.addInPlace(h.scale(e)),r.velocity.lengthSquared()>n&&(r.velocity=r.velocity.normalize().scale(t.maxSpeed)),r.position.addInPlace(r.velocity.scale(e))})),this._updateDebug()}},{key:"_updateCenter",value:function(){if(this.boids.length){var e=new BABYLON.Vector3(0,0,0),t=new BABYLON.Vector3(0,0,0);this.boids.forEach((function(n){e.addInPlace(n.position),t.addInPlace(n.velocity)})),e.scaleInPlace(1/this.boids.length),t.scaleInPlace(1/this.boids.length),this.center=e,this.avgVel=t}}},{key:"_forceCentreMass",value:function(e){return this.center.subtract(e.position).scale(this.cohesion)}},{key:"_forceSeparation",value:function(e){var t=this,n=new BABYLON.Vector3(0,0,0);return this.boids.forEach((function(r){if(e.id!==r.id){var o=e.position.subtract(r.position),c=o.length();c<t.separationMinDistance&&n.addInPlace(o.scale(t.separationMinDistance-c))}})),n.scale(this.separation)}},{key:"_forceMatchVelocity",value:function(e){return this.avgVel.subtract(e.velocity).scale(this.alignment)}},{key:"_forceBoundaries",value:function(e){var t=new BABYLON.Vector3(0,0,0),n=.2;return e.position.x<.9*this.boundsMin.x?t.x=n:e.position.x>.9*this.boundsMax.x&&(t.x=-.2),e.position.y<.9*this.boundsMin.y?t.y=n:e.position.y>.9*this.boundsMax.y&&(t.y=-.2),e.position.z<.9*this.boundsMin.z?t.z=n:e.position.z>.9*this.boundsMax.z&&(t.z=-.2),t}},{key:"addForce",value:function(e){this.otherForces.push(e)}},{key:"showDebug",value:function(e){if(!this.debug.show){var t=new BABYLON.StandardMaterial("debug_center",e);t.diffuseColor=BABYLON.Color3.FromHexString("#FF0000"),this.debug.center=BABYLON.MeshBuilder.CreateSphere("center",{diameter:.1,segments:8});var n=new BABYLON.StandardMaterial("debug_bbox",e);n.diffuseColor=BABYLON.Color3.FromHexString("#00FF00"),n.wireframe=!0,this.debug.center.material=t,this.debug.bbox=BABYLON.Mesh.CreateBox("boids_bbox",1,e),this.debug.bbox.scaling.x=Math.abs(this.boundsMax.x-this.boundsMin.x),this.debug.bbox.scaling.y=Math.abs(this.boundsMax.y-this.boundsMin.y),this.debug.bbox.scaling.z=Math.abs(this.boundsMax.z-this.boundsMin.z),this.debug.bbox.position.x=Math.abs(this.boundsMax.x-this.boundsMin.x)/2,this.debug.bbox.position.y=Math.abs(this.boundsMax.y-this.boundsMin.y)/2,this.debug.bbox.position.z=Math.abs(this.boundsMax.z-this.boundsMin.z)/2,this.debug.bbox.material=n;var r=new BABYLON.StandardMaterial("debug_wireframe",e);r.diffuseColor=BABYLON.Color3.FromHexString("#FFFFFF"),r.wireframe=!0;var o,c=y(this.boids);try{for(c.s();!(o=c.n()).done;){var l=o.value;l.debug={},l.debug.force=BABYLON.MeshBuilder.CreateTube("boid_arrow_".concat(l.uniqueId),{path:[l.position.add(l.velocity),l.position.clone()],radius:.01,updatable:!0},e),l.debug.influence=BABYLON.MeshBuilder.CreateSphere("boid_influence_".concat(l.uniqueId),{diameter:1,segments:8}),l.debug.influence.scaling.setAll(this.separationMinDistance),l.debug.influence.material=r}}catch(e){c.e(e)}finally{c.f()}this.debug.show=!0}}},{key:"hideDebug",value:function(e){this.debug.show=!1,this.debug.center=void 0;var t,n=y(this.boids);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.debug&&(r.debug.force.dispose(),r.debug.influence.dispose(),r.debug={})}}catch(e){n.e(e)}finally{n.f()}}},{key:"_updateDebug",value:function(){if(this.debug.show){this.debug.center.position.copyFrom(this.center);var e,t=y(this.boids);try{for(t.s();!(e=t.n()).done;){var n=e.value,path=[n.position.add(n.force.scale(20)),n.position.clone()];n.debug.force=BABYLON.MeshBuilder.CreateTube(n.debug.force.name,{path:path,radius:.01,instance:n.debug.force}),n.debug.influence.position.copyFrom(n.position)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"gui",value:function(e){var t=this,n=BABYLON.GUI,r=n.AdvancedDynamicTexture.CreateFullscreenUI("UI",void 0,void 0,e),o=new n.StackPanel;o.width="220px",o.horizontalAlignment=n.Control.HORIZONTAL_ALIGNMENT_RIGHT,o.verticalAlignment=n.Control.VERTICAL_ALIGNMENT_CENTER,r.addControl(o);var c=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},header=new n.TextBlock;header.text="".concat(e," ").concat(t[e]),header.height="30px",header.color="white",o.addControl(header);var l=new n.Slider;l.minimum=0,l.maximum=r,l.value=t[e],l.height="20px",l.width="200px";var d=function(e,header,t){return function(n){e[t]=n,header.text="".concat(t," ").concat(n),c.apply(e)}}(t,header,e);l.onValueChangedObservable.add(d),o.addControl(l)};c("cohesion",1.5),c("separation"),c("alignment"),c("separationMinDistance",50,(function(e){t.debug.center&&t.boids.forEach((function(e){e.debug.influence.scaling.setAll(t.separationMinDistance)}))}));var header=new n.TextBlock;header.text="show debug helpers",header.height="30px",header.color="white",o.addControl(header);var l=new n.Checkbox;l.width="20px",l.height="20px",l.isChecked=this.debug.show,l.color="green",l.onIsCheckedChangedObservable.add((function(n){n?t.showDebug(e):t.hideDebug(e)})),o.addControl(l)}}]),e}(),_=M;function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var C=n(328),E=n(329),A=n(330),O=n(331),k=n(251),P=n(251),R=function(){function e(t){var n=this;Object(h.a)(this,e),this.rttMaterials=[],this.lastDepth=0;var r=document.getElementById("underwater-3d");document.onfullscreenchange=function(e){n.isFullscreen=!!document.fullscreenElement},this.base=t.base,this.bootScene(r),this.lights(),this.materials(),this.composer();var o=[this.loadTerrain(),this.loadMoreiaBarco(),this.loadDiverBoat(),this.loadAudio()],c=this.loadFlock(this.base+"models/","salema.glb",50,new m.Vector3(-12.12,-13.2,27.19));o.push(c.promise),Promise.all(o).then((function(){console.log("all loaded")})),this.assetsManager.load(),t.$route.query.debug&&(this.camera.speed=.5,this.debugUtils());var l=new Date,d=!1,f=0;this.engine.runRenderLoop((function(){var e=(new Date-l)/1e3,r=n.engine.getDeltaTime()/1e3,o=n.camera.position.y<=0;if(d!==o&&(d=o,n.audioDiver.stop(),n.audioOcean.stop(),(d?n.audioDiver:n.audioOcean).play()),f++%8&&(t.depth=d?(-n.camera.position.y).toFixed(1):0,t.time=e,t.ascentSpeed=(n.camera.position.y-n.lastDepth)/r,t.orientationDegrees=180*n.camera.rotation.y/Math.PI,t.fps=n.engine.getFps().toFixed()),n.lastDepth=n.camera.position.y,t.$route.query.debug){var h=document.getElementById("inspector-host");h&&(h.style.position="absolute")}if(n.causticMaterial&&n.causticMaterial.setFloat("time",e),n.rttMaterials.forEach((function(t){t.setFloat("time",e)})),c.update(r),n.scene.render(),t.snapshotRequested){t.snapshotRequested=!1;var m=document.getElementById("underwater-3d").toDataURL(),v={title:"Laje de Santos",url:m},y=function(){var a=document.createElement("a"),e=(new Date).toJSON().slice(0,19).replaceAll(":","-");a.setAttribute("download","LajeDeSantos-"+e+".png"),a.setAttribute("href",m.replace("image/png","application/octet-stream")),a.click()};"share"in navigator?navigator.share(v).catch(y):y()}})),window.addEventListener("resize",this.resize.bind(this))}return Object(f.a)(e,[{key:"beforeDestroy",value:function(){window.removeEventListener("resize",this.resize.bind(this)),document.onfullscreenchange=null,this.engine.stopRenderLoop(),this.scene.dispose(),this.scene=null,this.engine=null}},{key:"bootScene",value:function(e){function t(){this.loadingUIText="Mergulho na Laje de Santos"}t.prototype.displayLoadingUI=function(){alert(this.loadingUIText)},t.prototype.hideLoadingUI=function(){alert("Loaded!")},this.engine=new m.Engine(e,!0),this.engine.loadingUIText="Mergulho na Laje de Santos",this.scene=new m.Scene(this.engine),this.scene.clearColor=new m.Color3(0,0,0);var n=new m.Vector3(-15.51978616737642,1.3786253122458585,29.13296827068854);"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?this.camera=new m.VirtualJoysticksCamera("Camera",n,this.scene):this.camera=new m.UniversalCamera("Camera",n,this.scene),this.camera.applyGravity=!1,this.camera.speed=.05,this.camera.ellipsoid=new m.Vector3(.5,1,.5),this.camera.keysUp.push("w".charCodeAt(0)),this.camera.keysUp.push("W".charCodeAt(0)),this.scene.onKeyboardObservable.add((function(e){switch(m.Engine.audioEngine.audioContext&&m.Engine.audioEngine.audioContext.resume(),e.type){case m.KeyboardEventTypes.KEYDOWN:console.log("KEY DOWN: ",e.event.key);break;case m.KeyboardEventTypes.KEYUP:console.log("KEY UP: ",e.event.keyCode)}})),this.camera.minZ=.1,this.camera.maxZ=700,this.camera.setTarget(new m.Vector3(-12.89001753167552,1.708562384403646,25.710433418293825)),this.camera.attachControl(e,!0),this.camera.inputs.attached.virtualJoystick&&this.camera.inputs.attached.virtualJoystick._rightjoystick.setJoystickSensibility(.01),this.scene.collisionsEnabled=!0,this.camera.checkCollisions=!0,this.scene.freezeActiveMeshes(),this.scene.autoClear=!1,this.scene.autoClearDepthAndStencil=!1,this.assetsManager=new m.AssetsManager(this.scene),this.assetsManager.onTaskErrorObservable.add((function(e){console.error("task failed",e.name,e.errorObject.message,e.errorObject.exception)}))}},{key:"sceneOptimizer",value:function(){var e=m.SceneOptimizerOptions.HighDegradationAllowed();e.optimizations=e.optimizations.filter((function(e){return!e.getDescription().includes("Merging similar meshes")}));m.SceneOptimizer.OptimizeAsync(this.scene,e)}},{key:"debugUtils",value:function(){this.scene.debugLayer.show()}},{key:"instrumentation",value:function(){var e=new m.EngineInstrumentation(this.engine);e.captureGPUFrameTime=!0,e.captureShaderCompilationTime=!0;var i=0;this.scene.registerBeforeRender((function(){i%30==0&&console.log("current frame time (GPU): "+(1e-6*e.gpuFrameTimeCounter.current).toFixed(2)+"ms\naverage frame time (GPU): "+(1e-6*e.gpuFrameTimeCounter.average).toFixed(2)+"ms\ntotal shader compilation time: "+e.shaderCompilationTimeCounter.total.toFixed(2)+"ms\naverage shader compilation time: "+e.shaderCompilationTimeCounter.average.toFixed(2)+"ms\ncompiler shaders count: "+e.shaderCompilationTimeCounter.count),i++}))}},{key:"resize",value:function(){this.engine.resize(),this.rebuildOceanTexture=!0}},{key:"lights",value:function(){var e=new m.HemisphericLight("light1",new m.Vector3(1,1,0),this.scene);e.diffuse=m.Color3.FromHexString("#CCCCCC"),e.intensity=.2;var t=new m.DirectionalLight("DirectionalLight",new m.Vector3(.2,-1,0),this.scene);t.diffuse=m.Color3.FromHexString("#FFFFFF"),t.intensity=.8}},{key:"getCausticMaterial",value:function(){var e=this.causticMaterial.clone();return e.freeze(),this.rttMaterials.push(e),e}},{key:"getCausticBlackMaterial",value:function(){var e=this.causticBlackMaterial.clone();return e.freeze(),this.rttMaterials.push(e),e}},{key:"materials",value:function(){m.Effect.ShadersStore.causticVertexShader=k.default,m.Effect.ShadersStore.causticFragmentShader=A.default,m.Effect.ShadersStore.causticblackVertexShader=P.default,m.Effect.ShadersStore.causticblackFragmentShader=O.default,this.causticMaterial=new m.ShaderMaterial("caustic material",this.scene,"caustic",{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection","time","direction"]}),this.causticMaterial.freeze(),this.causticBlackMaterial=new m.ShaderMaterial("caustic black material",this.scene,"causticblack",{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection","time","direction"]}),this.causticBlackMaterial.freeze()}},{key:"composer",value:function(){var e=this;m.Effect.ShadersStore.underwaterVertexShader=C.default,m.Effect.ShadersStore.underwaterFragmentShader=E.default;var t=this.scene.enableDepthRenderer(),n=new m.PassPostProcess("imagePass",1,null,m.Texture.NEAREST_SAMPLINGMODE,this.engine);n.clearColor=new m.Color4(0,0,0,0),this.renderTargetCaustic=new m.RenderTargetTexture("caustic",1024,this.scene),this.scene.customRenderTargets.push(this.renderTargetCaustic),this.setRTTMaterials();var r=new m.PostProcess("Underwater pass","underwater",["fogColor","cameraMinMaxZ","cameraPosition","time"],["skyTexture","depthTexture","causticTexture","oceanDepthTexture"],1,null,0,this.engine),o=new m.PostProcessRenderPipeline(this.engine,"pipeline"),c=new m.Texture(this.base+"textures/half_kloofendal_48d_partly_cloudy_4k.jpg",this.scene,!1,!0,m.Texture.NEAREST_NEAREST),l=this.loadOceanPP();this.oceanPostProcess=l;var d=null;l.onApplyObservable.add((function(t){if(e.rebuildOceanTexture){e.rebuildOceanTexture=!1;var n=r.inputTexture;d&&d.dispose(),(d=n.createDepthStencilTexture(void 0,void 0,e.engine.isStencilEnable)).name="underwaterDepthStencil"}e.engine.setDepthBuffer(!0),e.engine.setDepthWrite(!0),e.engine.clear(null,!1,!0,!1)})),r.onApplyObservable.add((function(e){e._bindTexture("oceanDepthTexture",d)})),this.oceanPostProcess.skyTexture=c;var h=new Date;r.onApply=function(n){var r=(new Date-h)/1e3;n.setColor3("fogColor",new m.Color3(0,.5,.85)),n.setFloat2("cameraMinMaxZ",e.camera.minZ,e.camera.maxZ),n.setFloat("time",r),n.setTexture("causticTexture",e.renderTargetCaustic),n.setTexture("depthTexture",t.getDepthMap()),n.setTexture("skyTexture",c),n.setVector3("cameraPosition",e.camera.position)};var f=new m.FxaaPostProcess("fxaa",1,null,null,this.engine),v=[n,l,r,f],y=new m.PostProcessRenderEffect(this.engine,"renderLayer",(function(){return v}));o.addEffect(y),this.scene.postProcessRenderPipelineManager.addPipeline(o),this.scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline("pipeline",this.camera)}},{key:"loadOceanPP",value:function(){var e=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},t={width:e(this.camera.getEngine().getRenderWidth()),height:e(this.camera.getEngine().getRenderHeight())};t.width>2048&&(t.width=2048),t.height>2048&&(t.height=2048),t.isPipeline=!0;var n=new v.a("myOcean",this.camera,t);return n.reflectionEnabled=!1,n.refractionEnabled=!1,n.autoClear=!1,n.worldScale=.2,n}},{key:"setRTTMaterialsSlow",value:function(){var e=this;this.renderTargetCaustic.onBeforeRender=function(){for(var i in e.renderTargetCaustic.renderList)e.renderTargetCaustic.renderList[i]._saved=e.renderTargetCaustic.renderList[i].material,e.renderTargetCaustic.renderList[i].material=e.renderTargetCaustic.renderList[i].rttMaterial},this.renderTargetCaustic.onAfterRender=function(){for(var i in e.renderTargetCaustic.renderList)e.renderTargetCaustic.renderList[i].material=e.renderTargetCaustic.renderList[i]._saved}}},{key:"setRTTMaterials",value:function(){var e=this;this.renderTargetCaustic.onBeforeRender=function(t){e.renderTargetCaustic.renderList.forEach((function(e){if("InstancedMesh"!==e.getClassName()){if(e.material&&!e.isFrozen&&"isReady"in e&&e.isReady(!0)){var t=[];e.subMeshes.forEach((function(e){t.push([e.effect,e._materialDefines])})),e.isFrozen=!0,e.material.freeze(),e._saved_orig_material=e.material,e._origSubMeshEffects=t}if(e._origSubMeshEffects&&(e.material=e.rttMaterial,e._rtt_subMeshEffects))for(var s=0;s<e.subMeshes.length;++s){var n;(n=e.subMeshes[s]).setEffect.apply(n,d(e._rtt_subMeshEffects[s]))}}}))},this.renderTargetCaustic.onAfterRender=function(){e.renderTargetCaustic.renderList.forEach((function(e){if("InstancedMesh"!==e.getClassName()&&e._origSubMeshEffects){e._rtt_subMeshEffects||(e._rtt_subMeshEffects=[],e.subMeshes.forEach((function(t){e._rtt_subMeshEffects.push([t.effect,t._materialDefines])}))),e.material=e._saved_orig_material;for(var s=0;s<e.subMeshes.length;++s){var t;(t=e.subMeshes[s]).setEffect.apply(t,d(e._origSubMeshEffects[s]))}}}))}}},{key:"addToSceneAndCaustic",value:function(e){var t=this,n=this.getCausticMaterial();return e.forEach((function(e){e.rttMaterial=n,t.renderTargetCaustic.renderList.push(e)})),n}},{key:"loadTerrain",value:function(){var e=this;return new Promise((function(t,n){var r=[],o=[],c=[],l=[],d=null,h=!1,f=function(){if(d&&h&&r.length){r[1].thinInstanceSetBuffer("matrix",d,16);e.addToSceneAndCaustic([r[1]]);t()}};e.assetsManager.addMeshTask("rocks",null,e.base+"models/ilha/","rocks.glb").onSuccess=function(e){console.log("rocks glb start"),e.loadedMeshes.forEach((function(e){"rockLow1"!==e.name&&"rockLow1.001"!==e.name&&"rockLow1.002"!==e.name||(e.freezeNormals(),e.freezeWorldMatrix(),e.material,r.push(e))})),console.log("rocks glb end"),f()},e.assetsManager.addTextFileTask("rocksMatrices",e.base+"models/ilha/rocks.base64").onSuccess=function(e){d=new Float32Array(m.DecodeBase64ToBinary(e.text)),f()},e.assetsManager.addMeshTask("terrain",null,e.base+"models/ilha/","ilha03.glb").onSuccess=function(t){var n=[];t.loadedMeshes.forEach((function(e){e.name.includes("rock")?(e.computeWorldMatrix(),o.push(e.getAbsolutePivotPoint()),c.push(e.rotationQuaternion),l.push(e.absoluteScaling),e.dispose()):e.freeze&&(e.doNotSyncBoundingInfo=!0,e.material&&e.material.freeze(),e.alwaysSelectAsActiveMesh=!0,e.cullingStrategy=m.AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,e.convertToUnIndexedMesh(),e.freezeNormals(),e.freezeWorldMatrix(),e.freeze(),e.bakeCurrentTransformIntoVertices(),n.push(e))}));e.addToSceneAndCaustic(n),m.Mesh.MergeMeshes(n,!0,!0,void 0,!1,!0);h=!0,f()}}))}},{key:"loadMoreiaBarco",value:function(){var e=this;return new Promise((function(t,n){e.assetsManager.addMeshTask("barcoMoreia",null,e.base+"models/","moreia-20210912.glb").onSuccess=function(n){var r,o=[],c=T(n.loadedMeshes);try{for(c.s();!(r=c.n()).done;){var l=r.value;l.position=new m.Vector3(-14.12,-17.2,27.19),l.material&&(l.material.backFaceCulling=!1,l.material.freeze(),o.push(l)),l.alwaysSelectAsActiveMesh=!0,l.cullingStrategy=m.AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,l.freezeNormals(),l.freezeWorldMatrix()}}catch(e){c.e(e)}finally{c.f()}e.addToSceneAndCaustic(o),t()}}))}},{key:"loadAudio",value:function(){var e=this;return new Promise((function(t,n){var r=function(){e.audioDiver&&e.audioOcean&&t()};e.assetsManager.addBinaryFileTask("sound_diver",e.base+"audio/156011__hdvideoguy__scubadiving-01.mp3").onSuccess=function(t){r(),e.audioDiver=new m.Sound("sound_diver",t.data,e.scene,(function(){}),{autoplay:!1,loop:!0})},e.assetsManager.addBinaryFileTask("sound_diver",e.base+"audio/435668__byjoshberry__ocean-waves-hitting-bow-of-moving-boat.mp3").onSuccess=function(t){r(),e.audioOcean=new m.Sound("sound_ocean",t.data,e.scene,(function(){e.audioOcean.play()}),{autoplay:!1,loop:!0})}}))}},{key:"loadDiverBoat",value:function(){var e=this;return new Promise((function(t,n){e.assetsManager.addMeshTask("diver_with_boat",null,e.base+"models/","diver_with_boat.glb").onSuccess=function(e){var n,r=T(e.loadedMeshes);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.position=new m.Vector3(-14.12,.5,27.19),o.material&&o.material.freeze(),o.alwaysSelectAsActiveMesh=!0}}catch(e){r.e(e)}finally{r.f()}t()}}))}},{key:"loadFlock",value:function(e,t,n,r){var o=this,c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=new m.Vector3(0,0,0),d=new _(n,l,1,30);d.cohesion=.01,d.alignment=.3,d.separationMinDistance=.1,d.maxSpeed=1,d.addForce((function(e,t){return l.subtract(t.position).scale(5.4)})),d.addForce((function(e,t){var n=o.camera.position.subtract(t.position);return n.lengthSquared<9?new m.Vector3(3,3,3).subtract(n).scale(100):l}));var h=null,f=new m.BakedVertexAnimationManager(this.scene),v=new Float32Array(16*n),y=new Float32Array(4*n),p=new Promise((function(l,d){o.assetsManager.addMeshTask("mesh"+t,null,e,t).onSuccess=function(e){var t,d=c?o.getCausticMaterial():null,w=T(e.loadedMeshes);try{for(w.s();!(t=w.n()).done;){var x=t.value;x.position=r,x.scaling=new m.Vector3(10,10,10),x.material&&x.material.freeze(),x.alwaysSelectAsActiveMesh=!0}}catch(e){w.e(e)}finally{w.f()}h=e.loadedMeshes[1],d&&(h.rttMaterial=d,o.renderTargetCaustic.renderList.push(h));for(var i=0;i<n;i++){var M=m.Matrix.Translation(o.random(-1,1),0,0);v.set(M.toArray(),16*i)}h.thinInstanceSetBuffer("matrix",v,16);var _=new m.VertexAnimationBaker(o.scene,h);_.bakeVertexData([{from:1,to:30,name:"swim"}]).then((function(e){var t=_.textureFromBakedVertexData(e);f.texture=t,h.bakedVertexAnimationManager=f;for(var r=0;r<n;r++){var c=m.Matrix.Translation(o.random(-1,1),o.random(-1,1),o.random(-1,1));v.set(c.toArray(),16*r);var l=new m.Vector4(1,30,0,30);y.set(l.asArray(),4*r)}h.thinInstanceSetBuffer("matrix",v,16),h.thinInstanceSetBuffer("bakedVertexAnimationSettingsInstanced",y,4)})),l()}}));return{models:[h],boidsManager:d,promise:p,update:function(e,t,n){return function(t){if(h&&h.bakedVertexAnimationManager){h.bakedVertexAnimationManager.time+=t,e.update(t);for(var i=0;i<n;i++){var r=e.boids[i],o=m.Matrix.Compose(new m.Vector3(1,1,1),new m.Quaternion(r.velocity.x,r.velocity.y,r.velocity.z,0),r.position);v.set(o.toArray(),16*i)}h.thinInstanceSetBuffer("matrix",v,16)}}}(d,0,n)}}},{key:"random",value:function(e,t){return Math.random()*(t-e)+e}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(e,t),n)}}]),e}(),D={props:{},data:function(){return{isFullscreen:!1,snapshotRequested:!1,ascentSpeed:0,depth:0,time:0,air:100,fps:0,orientationDegrees:0}},computed:{base:function(){return this.$router.options.base},ascentSpeedColor:function(){return this.ascentSpeed<1/60?"#000":this.ascentSpeed<.1||this.ascentSpeed<.2?"#0f0":this.ascentSpeed<.3?"#ff0":"#f00"},ascentSpeedGraph:function(){return 0===this.depth?"":this.ascentSpeed<1/60||this.ascentSpeed<.1?"<":this.ascentSpeed<.2?"<<":this.ascentSpeed<.3?"<<<":"<<<<"}},mounted:function(){this.underwater=new R(this)},methods:{fullscreen:function(){document.getElementById("underwater").requestFullscreen()}}},F=(n(332),n(4)),B={components:{Underwater:Object(F.a)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"underwater"}},[n("button",{directives:[{name:"show",rawName:"v-show",value:!e.isFullscreen,expression:"!isFullscreen"}],attrs:{id:"underwater-out"},on:{click:e.fullscreen}},[n("i18n",[e._v("Ficar em tela cheia")])],1),e._v(" "),n("canvas",{attrs:{id:"underwater-3d","touch-action":"none"}}),e._v(" "),n("div",{attrs:{id:"underwater-debug"}},[e._v("\n    "+e._s(e.fps)+" fps\n  ")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:!e.isFullscreen,expression:"!isFullscreen"}],attrs:{id:"underwater-fullscreen"},on:{click:e.fullscreen}},[n("i18n",[e._v("Ficar em tela cheia")])],1),e._v(" "),n("div",{attrs:{id:"underwater-hud"}},[n("div",{attrs:{id:"underwater-hud-depth"}},[n("span",{attrs:{id:"underwater-hud-depth-name"}},[n("i18n",[e._v("Profundidade")])],1),n("br"),e._v(" "),n("span",{style:{color:e.ascentSpeedColor},attrs:{id:"underwater-hud-depth-ascent"}},[e._v(e._s(e.ascentSpeedGraph))]),e._v(" "),n("span",{attrs:{id:"underwater-hud-depth-value"}},[e._v(e._s(e.depth))]),e._v(" "),n("span",{attrs:{id:"underwater-hud-depth-unit"}},[e._v("m")])]),e._v(" "),n("div",{attrs:{id:"underwater-hud-time"}},[n("span",{attrs:{id:"underwater-hud-time-name"}},[n("i18n",[e._v("Tempo")])],1),n("br"),e._v(" "),n("span",{attrs:{id:"underwater-hud-time-value"}},[e._v(e._s(parseInt(e.time/60,10))+":"+e._s(parseInt(e.time%60,10).toString().padStart(2,"0")))])]),e._v(" "),n("div",{attrs:{id:"underwater-hud-compass"}},[n("span",{attrs:{id:"underwater-hud-compass-name"}},[n("i18n",[e._v("Compasso")])],1),n("br"),e._v(" "),n("span",{attrs:{id:"underwater-hud-compass-value"}},[e._v(e._s((parseInt(e.orientationDegrees)%360+360)%360))])])]),e._v(" "),n("div",{attrs:{id:"underwater-settings"}},[n("font-awesome-icon",{attrs:{icon:["fas","camera"],size:"2x"},on:{click:function(t){e.snapshotRequested=!0}}})],1)])}),[],!1,null,"bc87a4d4",null).exports},extends:r.default,data:function(){return{}},mounted:function(){this.head.title=this.$gettext("Mergulho virtual"),this.head.description=this.$gettext("Mergulho em realidade virtual na Laje de Santos")}},V=Object(F.a)(B,(function(){var e=this.$createElement,t=this._self._c||e;return t("article",[t("section",[t("Underwater")],1)])}),[],!1,null,null,null);t.default=V.exports}}]);