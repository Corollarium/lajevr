(window.webpackJsonp=window.webpackJsonp||[]).push([[10,13],{199:function(e,t,n){"use strict";n.r(t);var r={data:function(){return{headerOverlay:!1,head:{title:"",description:""}}},watch:{headerOverlay:function(e,t){this.$root.$emit("headerOverlay",e)}},mounted:function(){this.$root.$emit("headerOverlay",this.headerOverlay)},head:function(){return{title:this.head.title,meta:[{hid:"description",name:"description",content:this.head.description}]}}},o=n(4),component=Object(o.a)(r,(function(){var e=this.$createElement;return(this._self._c||e)("div")}),[],!1,null,null,null);t.default=component.exports},222:function(e,t,n){"use strict";n(35),n(15),n(21),n(36),n(37),n(38);var r=n(97),o=n(98);n(29);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){d=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(d)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var d=function(){function e(t,n,o){Object(r.a)(this,e),this.id=t,this.position=n,this.velocity=o,this.force=new BABYLON.Vector3(0,0,0)}return Object(o.a)(e,[{key:"orientation",get:function(){return this.velocity.normalize()}}]),e}(),h=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(r.a)(this,e),this.cohesion=.3,this.separation=.4,this.alignment=1,this.separationMinDistance=3,this.maxSpeed=1,this.boundsMin=new BABYLON.Vector3(n.x-c,n.y-c,n.z-c),this.boundsMax=new BABYLON.Vector3(n.x+c,n.y+c,n.z+c),this.otherForces=[],this.boids=[],this.debug={show:!1,influences:[],arrows:[]},l||(l=new BABYLON.Vector3(.3,.1,.3));var h=l.length();this.center=n.clone(),this.avgVel=new BABYLON.Vector3(0,0,0);for(var i=0;i<t;i++){var f=this.center.add(new BABYLON.Vector3((Math.random()-.5)*o,(Math.random()-.5)*o,(Math.random()-.5)*o)),m=new BABYLON.Vector3(l.x+(Math.random()-.5)/10*h,l.y+(Math.random()-.5)/10*h,l.z+(Math.random()-.5)/10*h),v=new d(i,f,m);this.boids.push(v)}}return Object(o.a)(e,[{key:"update",value:function(e){var t=this;this._updateCenter();var n=this.maxSpeed*this.maxSpeed;this.boids.forEach((function(r){var o=t._forceCentreMass(r),c=t._forceSeparation(r),l=t._forceMatchVelocity(r),d=t._forceBoundaries(r),h=o.add(c).add(l).add(d);t.otherForces.forEach((function(e){h.add(e(t,r))})),r.force.copyFrom(h),r.velocity.addInPlace(h.scale(e)),r.velocity.lengthSquared()>n&&(r.velocity=r.velocity.normalize().scale(t.maxSpeed)),r.position.addInPlace(r.velocity.scale(e))})),this._updateDebug()}},{key:"_updateCenter",value:function(){if(this.boids.length){var e=new BABYLON.Vector3(0,0,0),t=new BABYLON.Vector3(0,0,0);this.boids.forEach((function(n){e.addInPlace(n.position),t.addInPlace(n.velocity)})),e.scaleInPlace(1/this.boids.length),t.scaleInPlace(1/this.boids.length),this.center=e,this.avgVel=t}}},{key:"_forceCentreMass",value:function(e){return this.center.subtract(e.position).scale(this.cohesion)}},{key:"_forceSeparation",value:function(e){var t=this,n=new BABYLON.Vector3(0,0,0);return this.boids.forEach((function(r){if(e.id!==r.id){var o=e.position.subtract(r.position),c=o.length();c<t.separationMinDistance&&n.addInPlace(o.scale(t.separationMinDistance-c))}})),n.scale(this.separation)}},{key:"_forceMatchVelocity",value:function(e){return this.avgVel.subtract(e.velocity).scale(this.alignment)}},{key:"_forceBoundaries",value:function(e){var t=new BABYLON.Vector3(0,0,0),n=.2;return e.position.x<.9*this.boundsMin.x?t.x=n:e.position.x>.9*this.boundsMax.x&&(t.x=-.2),e.position.y<.9*this.boundsMin.y?t.y=n:e.position.y>.9*this.boundsMax.y&&(t.y=-.2),e.position.z<.9*this.boundsMin.z?t.z=n:e.position.z>.9*this.boundsMax.z&&(t.z=-.2),t}},{key:"addForce",value:function(e){this.otherForces.push(e)}},{key:"showDebug",value:function(e){if(!this.debug.show){var t=new BABYLON.StandardMaterial("debug_center",e);t.diffuseColor=BABYLON.Color3.FromHexString("#FF0000"),this.debug.center=BABYLON.MeshBuilder.CreateSphere("center",{diameter:.1,segments:8});var n=new BABYLON.StandardMaterial("debug_bbox",e);n.diffuseColor=BABYLON.Color3.FromHexString("#00FF00"),n.wireframe=!0,this.debug.center.material=t,this.debug.bbox=BABYLON.Mesh.CreateBox("boids_bbox",1,e),this.debug.bbox.scaling.x=Math.abs(this.boundsMax.x-this.boundsMin.x),this.debug.bbox.scaling.y=Math.abs(this.boundsMax.y-this.boundsMin.y),this.debug.bbox.scaling.z=Math.abs(this.boundsMax.z-this.boundsMin.z),this.debug.bbox.position.x=Math.abs(this.boundsMax.x-this.boundsMin.x)/2,this.debug.bbox.position.y=Math.abs(this.boundsMax.y-this.boundsMin.y)/2,this.debug.bbox.position.z=Math.abs(this.boundsMax.z-this.boundsMin.z)/2,this.debug.bbox.material=n;var r=new BABYLON.StandardMaterial("debug_wireframe",e);r.diffuseColor=BABYLON.Color3.FromHexString("#FFFFFF"),r.wireframe=!0;var o,l=c(this.boids);try{for(l.s();!(o=l.n()).done;){var d=o.value;d.debug={},d.debug.force=BABYLON.MeshBuilder.CreateTube("boid_arrow_".concat(d.uniqueId),{path:[d.position.add(d.velocity),d.position.clone()],radius:.01,updatable:!0},e),d.debug.influence=BABYLON.MeshBuilder.CreateSphere("boid_influence_".concat(d.uniqueId),{diameter:1,segments:8}),d.debug.influence.scaling.setAll(this.separationMinDistance),d.debug.influence.material=r}}catch(e){l.e(e)}finally{l.f()}this.debug.show=!0}}},{key:"hideDebug",value:function(e){this.debug.show=!1,this.debug.center=void 0;var t,n=c(this.boids);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.debug&&(r.debug.force.dispose(),r.debug.influence.dispose(),r.debug={})}}catch(e){n.e(e)}finally{n.f()}}},{key:"_updateDebug",value:function(){if(this.debug.show){this.debug.center.position.copyFrom(this.center);var e,t=c(this.boids);try{for(t.s();!(e=t.n()).done;){var n=e.value,path=[n.position.add(n.force.scale(20)),n.position.clone()];n.debug.force=BABYLON.MeshBuilder.CreateTube(n.debug.force.name,{path:path,radius:.01,instance:n.debug.force}),n.debug.influence.position.copyFrom(n.position)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"gui",value:function(e){var t=this,n=BABYLON.GUI,r=n.AdvancedDynamicTexture.CreateFullscreenUI("UI",void 0,void 0,e),o=new n.StackPanel;o.width="220px",o.horizontalAlignment=n.Control.HORIZONTAL_ALIGNMENT_RIGHT,o.verticalAlignment=n.Control.VERTICAL_ALIGNMENT_CENTER,r.addControl(o);var c=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},header=new n.TextBlock;header.text="".concat(e," ").concat(t[e]),header.height="30px",header.color="white",o.addControl(header);var l=new n.Slider;l.minimum=0,l.maximum=r,l.value=t[e],l.height="20px",l.width="200px";var d=function(e,header,t){return function(n){e[t]=n,header.text="".concat(t," ").concat(n),c.apply(e)}}(t,header,e);l.onValueChangedObservable.add(d),o.addControl(l)};c("cohesion",1.5),c("separation"),c("alignment"),c("separationMinDistance",50,(function(e){t.debug.center&&t.boids.forEach((function(e){e.debug.influence.scaling.setAll(t.separationMinDistance)}))}));var header=new n.TextBlock;header.text="show debug helpers",header.height="30px",header.color="white",o.addControl(header);var l=new n.Checkbox;l.width="20px",l.height="20px",l.isChecked=this.debug.show,l.color="green",l.onIsCheckedChangedObservable.add((function(n){n?t.showDebug(e):t.hideDebug(e)})),o.addControl(l)}}]),e}();t.a=h},225:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));n(226);var r=n(97),o=n(98),c=n(239),l=n(240),d=n(228),h=n(200);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var o=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=f(n);function n(e,o){var c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(r.a)(this,n),(c=t.call(this,e,"./oceanPostProcess",["time","fov","resolution","cameraPosition","cameraRotation","worldScale","lightDirection"],["positionSampler","reflectionSampler","refractionSampler","skyTexture"],{width:l.width||o.getEngine().getRenderWidth(),height:l.height||o.getEngine().getRenderHeight()},l.isPipeline?null:o,h.Texture.TRILINEAR_SAMPLINGMODE,o.getEngine(),!0))._time=0,c.worldScale=1,c._cameraRotation=h.Vector3.Zero(),c._cameraViewMatrix=h.Matrix.Identity(),c._reflectionEnabled=!1,c._refractionEnabled=!1,c._skyTexture=null,c._camera=o,c._options=l,c.reflectionTexture=null,c.refractionTexture=null,c._geometryRenderer=o.getScene().enableGeometryBufferRenderer(1),c.light="light"in l?l.light:null,c._geometryRenderer&&c._geometryRenderer.isSupported?c._geometryRenderer.enablePosition=!0:c.updateEffect("#define NOT_SUPPORTED\n"),c.onApply=function(e){if(c._geometryRenderer&&c._geometryRenderer.isSupported){var t=o.getEngine(),n=o.getScene();c._time+=.001*t.getDeltaTime(),e.setFloat("time",c._time);e.setVector2("resolution",new h.Vector2(t.getRenderWidth()/1,t.getRenderHeight()/1)),n&&(e.setVector3("cameraPosition",o.globalPosition),c._computeCameraRotation(o),e.setVector3("cameraRotation",c._cameraRotation),e.setVector3("lightDirection",c.light?c.light.direction:new h.Vector3(.2,-1,0)),e.setFloat("fov",o.fov),e.setFloat("worldScale",c.worldScale),e.setTexture("positionSampler",c._geometryRenderer.getGBuffer().textures[2]),c._reflectionEnabled&&e.setTexture("reflectionSampler",c.reflectionTexture),c._refractionEnabled&&e.setTexture("refractionSampler",c.refractionTexture),c._skyTexture&&e.setTexture("skyTexture",c._skyTexture))}},c}return Object(o.a)(n,[{key:"reflectionEnabled",get:function(){return this._reflectionEnabled},set:function(e){if(this._reflectionEnabled!==e){this._reflectionEnabled=e,e&&!this.reflectionTexture&&(this.reflectionTexture=new h.MirrorTexture("oceanPostProcessReflection",this._options.reflectionSize||{width:512,height:512},this._camera.getScene()),this.reflectionTexture.mirrorPlane=h.Plane.FromPositionAndNormal(h.Vector3.Zero(),new h.Vector3(0,-1,0))),this.updateEffect(this._getDefines());var t=this.getCamera().getScene().customRenderTargets;if(e)t.push(this.reflectionTexture);else{var n=t.indexOf(this.reflectionTexture);-1!==n&&t.splice(n,1)}}}},{key:"refractionEnabled",get:function(){return this._refractionEnabled},set:function(e){if(this._refractionEnabled!==e){this._refractionEnabled=e,e&&!this.refractionTexture&&(this.refractionTexture=new h.RenderTargetTexture("oceanPostProcessRefraction",this._options.refractionSize||{width:512,height:512},this._camera.getScene())),this.updateEffect(this._getDefines());var t=this.getCamera().getScene().customRenderTargets;if(e)t.push(this.refractionTexture);else{var n=t.indexOf(this.refractionTexture);-1!==n&&t.splice(n,1)}}}},{key:"skyTexture",set:function(e){this._skyTexture=e,this.updateEffect(this._getDefines())}},{key:"isSupported",get:function(){return null!==this._geometryRenderer&&this._geometryRenderer.isSupported}},{key:"_getDefines",value:function(){var e=[];return this._reflectionEnabled&&e.push("#define REFLECTION_ENABLED"),this._refractionEnabled&&e.push("#define REFRACTION_ENABLED"),this._skyTexture&&e.push("#define SKY_ENABLED"),e.join("\n")}},{key:"_computeCameraRotation",value:function(e){e.upVector.normalize();var t=e.getTarget();e._initialFocalDistance=t.subtract(e.position).length(),e.position.z===t.z&&(e.position.z+=h.Epsilon);var n=t.subtract(e.position);e._viewMatrix.invertToRef(this._cameraViewMatrix),this._cameraRotation.x=Math.atan(this._cameraViewMatrix.m[6]/this._cameraViewMatrix.m[10]),n.x>=0?this._cameraRotation.y=-Math.atan(n.z/n.x)+Math.PI/2:this._cameraRotation.y=-Math.atan(n.z/n.x)-Math.PI/2,this._cameraRotation.z=0,isNaN(this._cameraRotation.x)&&(this._cameraRotation.x=0),isNaN(this._cameraRotation.y)&&(this._cameraRotation.y=0),isNaN(this._cameraRotation.z)&&(this._cameraRotation.z=0)}}]),n}(h.PostProcess)},226:function(e,t,n){var r=n(2),o=n(68),c=n(54),l=n(7),d=n(12),h=n(8),f=n(227),m=(n(5).Reflect||{}).construct,v=h((function(){function e(){}return!(m((function(){}),[],e)instanceof e)})),y=!h((function(){m((function(){}))}));r(r.S+r.F*(v||y),"Reflect",{construct:function(e,t){c(e),l(t);var n=arguments.length<3?e:c(arguments[2]);if(y&&!v)return m(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(f.apply(e,r))}var h=n.prototype,w=o(d(h)?h:Object.prototype),x=Function.apply.call(e,w,t);return d(x)?x:w}})},227:function(e,t,n){"use strict";var r=n(54),o=n(12),c=n(140),l=[].slice,d={},h=function(e,t,n){if(!(t in d)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";d[t]=Function("F,a","return new F("+r.join(",")+")")}return d[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=l.call(arguments,1),d=function(){var r=n.concat(l.call(arguments));return this instanceof d?h(t,r.length,r):c(t,r,e)};return o(t.prototype)&&(d.prototype=t.prototype),d}},228:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,"a",(function(){return r}))},239:function(e,t,n){"use strict";function r(e,p){return r=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e},r(e,p)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,"a",(function(){return o}))},240:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(17);function o(e,t){return!t||"object"!==Object(r.a)(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}},250:function(e,t,n){"use strict";n.r(t),t.default="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform mat4 worldViewProjection;\nuniform vec2 cameraMinMaxZ;\n\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n// varying float normalizedDepth;\n\n#include<bonesDeclaration>\n#include<instancesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n\n/*\n * Vertex shader for caustic and babylonjs.\n */\nvoid main() {\n    vec3 positionUpdated = position;\n\n    // include shaders to calculate instances and bones\n    #include<instancesVertex>\n    #include<bonesVertex>\n    #include<bakedVertexAnimation>\n\n    // return normal, uv and position\n    vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);\n    vec4 viewPos = view * worldPos;\n\n    // float distancetoCamera = -viewPos.z;\n    // float distance = (cameraMinMaxZ.x + (cameraMinMaxZ.y - cameraMinMaxZ.x)*depth);\n    // float normalizedDistance = distance / cameraMinMaxZ.x;\n    // normalizedDepth = (distancetoCamera - cameraMinMaxZ.x)/(cameraMinMaxZ.y - cameraMinMaxZ.x);\n\n    vNormal = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n    vPosition = worldPos.xyz;\n    vUV = uv;\n\n    gl_Position = projection * viewPos;\n}\n"},251:function(e,t,n){var content=n(337);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(28).default)("74214df3",content,!0,{sourceMap:!1})},332:function(e,t,n){"use strict";n.r(t),t.default="precision highp float;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 worldViewProjection;\n\nvarying vec2 vUV;\n\nvoid main() {\n  vUV = uv;\n  gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n"},333:function(e,t,n){"use strict";n.r(t),t.default="precision highp float;\n\nvarying vec2 vUV;\n\nuniform float time;\nuniform vec3 fogColor;\nuniform vec2 cameraMinMaxZ;\nuniform vec3 cameraPosition;\n\nuniform sampler2D textureSampler; // rendered buffer\nuniform sampler2D causticTexture; // multipass caustic texture\nuniform sampler2D depthTexture; // z-depth map for rendered buffer\nuniform sampler2D oceanDepthTexture; // z-depth map for ocean pass\nuniform sampler2D skyTexture; // the spherical sky texture\n\n\n#define csb(f, con, sat, bri) mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), f*bri)), f*bri, sat), con)\n\n#define TAU 6.28318530718\n#define MAX_ITER 8\n#define BASE_INTEN .005\n#define FOG_DENSITY 2.8\n#define FOG_DISTANCE_CORRECTION 6.0 // move the far plane closer\n#define SEA_BASE_COLOR vec3(0.0, 0.176, 0.333)\n\nfloat fogFactorExp(\n  const float dist,\n  const float density\n) {\n  return 1.0 - clamp(exp2(-density * dist), 0.0, 1.0);\n}\n\nfloat causticX(float x, float power, float gtime)\n{\n  float p = mod(x*TAU, TAU)-250.0;\n  float tTime = gtime * .5+23.0;\n\n\tfloat i = p;\n\tfloat c = 1.0;\n\tfloat inten = BASE_INTEN;\n\n\tfor (int n = 0; n < MAX_ITER/2; n++)\n\t{\n\t\tfloat t = tTime * (1.0 - (3.5 / float(n+1)));\n\t\ti = p + cos(t - i) + sin(t + i);\n\t\tc += 1.0/length(p / (sin(i+t)/inten));\n\t}\n\tc /= float(MAX_ITER);\n\tc = 1.17-pow(c, power);\n\n    return c;\n}\n\nfloat godRaysCalc(vec2 uv)\n{\n    float light = 0.0;\n\n    light += pow(causticX((uv.x+0.08*uv.y)/1.7+0.5, 1.8, time*0.65),10.0)*0.05;\n    light -= pow((1.0-uv.y)*0.3,2.0)*0.2;\n    light += pow(causticX(sin(uv.x), 0.3,time*0.7),9.0)*0.4;\n    light += pow(causticX(cos(uv.x*2.3), 0.3,time*1.3),4.0)*0.1;\n\n    light -= pow((1.0-uv.y)*0.3,3.0);\n    light = clamp(light,0.0,1.0);\n\n    return light;\n}\n\nvoid main() {\n  // base texture\n  vec4 base = texture2D(textureSampler, vUV);\n\n  vec4 depthVec = texture2D(depthTexture, vUV);\n  float Zdepth = depthVec.r;\n\n  // no effect above water\n  if (cameraPosition.y >= 0.0) {\n    gl_FragColor.rgb = base.rgb;\n    gl_FragColor.w = 1.0;\n    return;\n  }\n\n  // apply visibility loss with distance\n  vec4 oceanDepthVec = texture2D(oceanDepthTexture, vUV);\n  float oceanZDepth = oceanDepthVec.r;\n\n  vec4 color;\n  if (oceanZDepth < Zdepth && oceanZDepth != 1.0) {\n    // if we have no fog, this smoothing of the horizon is required.\n\n    // const float MAX_Z_SMOOTH = 0.6;\n    // if (oceanZDepth / Zdepth > MAX_Z_SMOOTH) {\n    //   // smooth out large Z, so we have a pretty infinity\n    //   color.rgb = mix(fogColor, base.rgb, smoothstep(1.0, 0.0, oceanZDepth / Zdepth * MAX_Z_SMOOTH));\n    // }\n    // else {\n    //   // just the ocean, thanks\n    //   color.rgb = base.rgb;\n    // }\n    color.rgb = base.rgb;\n    Zdepth = oceanZDepth;\n  }\n  else {\n    // apply underwater effects\n\n    // god rays\n    vec3 skyColor = SEA_BASE_COLOR;\n    // TODO: godRays should take camera angle into consideration\n    vec3 godRays = 0.7*(godRaysCalc(vUV*2.)*mix(float(skyColor), 1.0, vUV.y*vUV.y) * vec3(0.7,1.0,1.0));\n\n    // TODO: noise\n    // TODO: color loss with depth\n    vec4 caustic = texture2D(causticTexture, vUV);\n\n    // color.rgb = base.rgb; // plain\n    // color.r = actualDepth.r; // plain\n    // color.rgb = caustic.rgb; // pure caustic\n    // color.rgb = godRays; // pure god rays\n    // color.rgb = vec3(distance, distance, distance); ; // just depth\n    // color.rgb = vec3(distance / cameraMinMaxZ.y, distance / cameraMinMaxZ.y, distance / cameraMinMaxZ.y); // normalized depth\n    color.rgb = mix(base.rgb, caustic.rgb, clamp(caustic.a * 0.5 * Zdepth, 0.2, 0.7)); // caustics + texture\n  }\n\n  // actual distance from the lens in scene units\n  float distance = (cameraMinMaxZ.x + (cameraMinMaxZ.y - cameraMinMaxZ.x)*Zdepth);\n  float normalizedDistance = distance / cameraMinMaxZ.y;\n  float fogFactor = clamp(\n    1.4 * fogFactorExp(normalizedDistance, FOG_DENSITY * FOG_DISTANCE_CORRECTION),\n    0.0,\n    1.0\n  );\n  // color.rgb = vec3(fogFactor, fogFactor, fogFactor); // pure fog\n  // color.rgb = mix(base.rgb, fogColor, fogFactor); // fog + texture\n  color.rgb = mix(\n    color.rgb,\n    fogColor,\n    fogFactor\n  ); // + godRays; // everything\n\n  // color, saturation, brightness\n  color.rgb = csb(color.rgb, 1.1, 1.05, 1.22);\n\n  // Vignette\n  // color.rgb = mix(color.rgb, vec3(.0), abs(vUV.x - 0.5)*abs(vUV.y * 2.0 - 1.0));\n\n  gl_FragColor.rgb = color.rgb;\n  gl_FragColor.w = 1.0; //base.w;\n}\n"},334:function(e,t,n){"use strict";n.r(t),t.default="#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define TAU 6.28318530718\n#define MAX_ITER 5\n#define SPEED 0.3\n#define SCALE 30.0\n\nuniform float time;\n\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvec4 caustic(vec2 uv) {\n  vec2 p = mod(uv*TAU, TAU)-250.0;\n  float t = time * SPEED + 23.0;\n\n  vec2 i = vec2(p);\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER; n++) {\n    float t = t * (1.0 - (3.5 / float(n+1)));\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\n  }\n\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, 1.4);\n  vec3 color = vec3(pow(abs(c), 8.0));\n  color = clamp(color + vec3(0.0, 0.0, 0.0), 0.0, 1.0);\n\n  float alpha=0.5;\n  float contrast=0.0;\n  color = mix(color, vec3(1.0,1.0,1.0),contrast);\n  //color.a = alpha;\n  vec4 color4 = vec4(color,0.0);\n\n  return color4;\n}\n\n/*\n * Fragment shader for caustic and babylonjs. Renders a fake caustic, using an\n * animated noise function and the world coordinates as UV.\n */\nvoid main(void)\n{\n  // TODO: y coordinate should multiply caustic to reduce light on higher ocean depths\n\n  vec2 coord = vec2(fract(vPosition.x/SCALE), fract(vPosition.z/SCALE));\n  if (vNormal.y > 0.0 && vPosition.y < 0.0) {\n    // scale by normal to make caustic less pronounced for more vertical faces.\n    gl_FragColor = clamp(caustic(coord), 0.0, 1.0) * vNormal.y;\n    gl_FragColor.a = 1.0;\n  }\n  else {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n  }\n}\n\n"},335:function(e,t,n){"use strict";n.r(t),t.default="#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform float time;\n\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\n/*\n * simple pure black shader for objects that should not render caustics.\n */\nvoid main(void)\n{\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n}\n\n"},336:function(e,t,n){"use strict";n(251)},337:function(e,t,n){var r=n(27)(!1);r.push([e.i,"#underwater[data-v-d43b8708]{height:100vh;width:100%;position:relative}#underwater-3d[data-v-d43b8708]{height:100vh;width:100vw}#underwater-debug[data-v-d43b8708]{top:0;right:0;z-index:1000}#underwater-debug[data-v-d43b8708],#underwater-hud[data-v-d43b8708]{position:absolute;padding:10px;border-radius:10px;background:#000;color:#fff;text-align:right}#underwater-hud[data-v-d43b8708]{bottom:0;left:0;width:160px;height:220px;z-index:10;font-family:monospace}#underwater-hud span[data-v-d43b8708]{display:inline-block}#underwater-hud #underwater-hud-compass[data-v-d43b8708],#underwater-hud #underwater-hud-time[data-v-d43b8708]{margin-top:10px}#underwater-hud #underwater-hud-compass-value[data-v-d43b8708],#underwater-hud #underwater-hud-depth-value[data-v-d43b8708],#underwater-hud #underwater-hud-time-value[data-v-d43b8708]{line-height:.9;font-size:42px;font-family:monospace}#underwater-hud #underwater-hud-depth-ascent[data-v-d43b8708]{-ms-writing-mode:tb-rl;writing-mode:vertical-rl}#underwater-hud #underwater-hud-compass-name[data-v-d43b8708],#underwater-hud #underwater-hud-depth-name[data-v-d43b8708],#underwater-hud #underwater-hud-time-name[data-v-d43b8708]{color:#4c70ff}#underwater-hud #underwater-hud-depth-unit[data-v-d43b8708],#underwater-hud #underwater-hud-time-unit[data-v-d43b8708]{vertical-align:top}#underwater-fullscreen[data-v-d43b8708]{position:absolute;top:20px;left:0;padding:20px;margin:0;z-index:1;max-width:80%;line-height:1.2em;border-radius:10px;font-size:42px;background:#004;color:#fff;text-align:center}#underwater-settings[data-v-d43b8708]{position:absolute;bottom:0;right:0;padding:10px;z-index:1000;color:#fff;text-align:right}#underwater-settings svg[data-v-d43b8708]{cursor:pointer}",""]),e.exports=r},419:function(e,t,n){"use strict";n.r(t);var r=n(6);n(50);function o(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}l((r=r.apply(e,t||[])).next())}))}const c=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","radeon r9 200","sgx 543","sgx543"],l=e=>e.toLowerCase().replace(/^angle ?\((.+)\)*$/,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,""),d="undefined"==typeof window,h=(()=>{if(d)return;const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(e),a="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;return{isIpad:a,isMobile:/android/i.test(e)||r||a,isSafari12:/Version\/12.+Safari/.test(e)}})(),f=[],m=[],v=(e,t)=>{if(e===t)return 0;const n=e;e.length>t.length&&(e=t,t=n);let r=e.length,o=t.length;for(;r>0&&e.charCodeAt(~-r)===t.charCodeAt(~-o);)r--,o--;let a,c=0;for(;c<r&&e.charCodeAt(c)===t.charCodeAt(c);)c++;if(r-=c,o-=c,0===r)return o;let l,d,s=0,g=0,p=0;for(;g<r;)m[g]=e.charCodeAt(c+g),f[g]=++g;for(;p<o;)for(a=t.charCodeAt(c+p),l=p++,s=p,g=0;g<r;g++)d=a===m[g]?l:l+1,l=f[g],s=f[g]=l>s?d>s?s+1:d:d>l?l+1:d;return s},y=({mobileTiers:i=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:n,failIfMajorPerformanceCaveat:s=!1,benchmarksURL:g="https://unpkg.com/detect-gpu@3.1.27/dist/benchmarks"}={})=>o(void 0,void 0,void 0,(function*(){const p={};if(d)return{tier:0,type:"SSR"};const{isIpad:u=!!(null==h?void 0:h.isIpad),isMobile:r=!!(null==h?void 0:h.isMobile),screenSize:f=window.screen,loadBenchmarks:m=(e=>o(void 0,void 0,void 0,(function*(){const t=yield fetch(`${g}/${e}`).then((e=>e.json()));return t.shift(),t})))}=t;let{renderer:y}=t;const w=(e,t,n,o,c)=>({device:c,fps:o,gpu:n,isMobile:r,tier:e,type:t});let x,M="";if(y)y=l(y),x=[y];else{const e=n||((e,t=!1)=>{const n={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete n.powerPreference;const r=window.document.createElement("canvas"),o=r.getContext("webgl",n)||r.getContext("experimental-webgl",n);return null!=o?o:void 0})(null==h?void 0:h.isSafari12,s);if(!e)return w(0,"WEBGL_UNSUPPORTED");const t=e.getExtension("WEBGL_debug_renderer_info");if(t&&(y=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),!y)return w(1,"FALLBACK");M=y,y=l(y),x=((e,t,n)=>"apple gpu"===t?((e,t,n)=>{let r=[t];if(n){const t="\n      precision highp float;\n      attribute vec3 aPosition;\n      varying float vvv;\n      void main() {\n        vvv = 0.31622776601683794;\n        gl_Position = vec4(aPosition, 1.0);\n      }\n    ",n="\n      precision highp float;\n      varying float vvv;\n      void main() {\n        vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n        enc = fract(enc);\n        enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n        gl_FragColor = enc;\n      }\n    ",a=e.createShader(35633),i=e.createShader(35632),o=e.createProgram();if(i&&a&&o){e.shaderSource(a,t),e.shaderSource(i,n),e.compileShader(a),e.compileShader(i),e.attachShader(o,a),e.attachShader(o,i),e.linkProgram(o),e.detachShader(o,a),e.detachShader(o,i),e.deleteShader(a),e.deleteShader(i),e.useProgram(o);const c=e.createBuffer();e.bindBuffer(34962,c),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const l=e.getAttribLocation(o,"aPosition");e.vertexAttribPointer(l,3,5126,!1,0,0),e.enableVertexAttribArray(l),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const d=new Uint8Array(4);e.readPixels(0,0,1,1,6408,5121,d),e.deleteProgram(o),e.deleteBuffer(c),r={801621810:(null==h?void 0:h.isIpad)?["apple a12x gpu"]:["apple a11 gpu","apple a12 gpu","apple a13 gpu","apple a14 gpu"],8016218135:(null==h?void 0:h.isIpad)?["apple a9x gpu","apple a10 gpu","apple a10x gpu"]:["apple a9 gpu","apple a10 gpu"]}[d.join("")]||r}}return r})(e,t,n):[t])(e,y,r)}const b=(yield Promise.all(x.map((e=>o(void 0,void 0,void 0,(function*(){const t=(e=>{const t=r?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","amd","radeon","nvidia","geforce"];for(const n of t)if(e.includes(n))return n})(e);if(!t)return;const n=`${r?"m":"d"}-${t}.json`,o=p[n]=p[n]||m(n);let c;try{c=yield o}catch(t){return}const a=(e=>{var t;const n=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==n?void 0:n.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""})(e),i="apple"===t;let l=c.filter((([,e])=>e===a));l.length||(l=c.filter((([t])=>t.includes(e))));const d=l.length;if(0===d)return;let h,[s,,,g]=d>1?l.map((t=>[t,v(e,t[0])])).sort((([,e],[,t])=>e-t))[0][0]:l[0],y=Number.MAX_VALUE;const{devicePixelRatio:w}=window,x=f.width*w*(f.height*w);i&&r&&(g=g.filter((([,,,e])=>{var t;return(null!==(t=null==e?void 0:e.indexOf(u?"ipad":"iphone"))&&void 0!==t?t:-1)>-1})));for(const e of g){const[t,n]=e,r=t*n,o=Math.abs(x-r);o<y&&(y=o,h=e)}if(!h)return;const[,,M,b]=h;return[y,M,s,b]})))))).filter((e=>!!e));if(!b.length){const e=c.find((e=>y.includes(e)));return e?w(0,"BLOCKLISTED",e):w(1,"FALLBACK",`${y} (${M})`)}const[,_,T,S]=b.sort((([e=Number.MAX_VALUE],[t=Number.MAX_VALUE])=>e-t))[0];if(-1===_)return w(0,"BLOCKLISTED",T,_,S);const E=r?i:e;let C=0;for(let e=0;e<E.length;e++)_>=E[e]&&(C=e);return w(C,"BENCHMARK",T,_,S)}));var w=n(199),x=n(86);var M=n(118),_=n(64);function T(e){return function(e){if(Array.isArray(e))return Object(x.a)(e)}(e)||Object(M.a)(e)||Object(_.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var S=n(97),E=n(98),C=(n(37),n(15),n(38),n(35),n(40),n(29),n(39),n(70),n(71),n(221),n(21),n(36),n(200)),A=(n(210),n(225)),O=n(222);function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var D=n(332),R=n(333),L=n(334),B=n(335),F=n(250),V=n(250),I=function(){function e(t){var n=this;Object(S.a)(this,e),this.base="",this.engine=null,this.scene=null,this.camera=null,this.assetsManager=null,this.sunLight=null,this.oceanPostProcess=null,this.renderTargetCaustic=null,this.causticMaterial=null,this.causticBlackMaterial=null,this.rttMaterials=[],this.rebuildOceanTexture=!0,this.audioDiver=null,this.audioOcean=null;var r=document.getElementById("underwater-3d");document.onfullscreenchange=function(e){t.isFullscreen=!!document.fullscreenElement},this.base=t.base,this.bootScene(r),this.lights(),this.materials(),this.composer();var o=[this.loadTerrain(),this.loadMoreiaBarco(),this.loadDiverBoat(),this.loadAudio()],c=this.loadFlock(this.base+"models/","salema.glb",50,new C.Vector3(-12.12,-13.2,27.19),[{from:1,to:92,name:"swim"}]);o.push(c.promise),Promise.all(o).then((function(){console.log("all loaded")})),this.assetsManager.load(),t.$route.query.debug&&(this.camera.speed=.5,this.debugUtils(),C.Engine.audioEngine.setGlobalVolume(0));var l=new Date,d=!1,h=0;this.engine.runRenderLoop((function(){var e=(new Date-l)/1e3,r=n.engine.getDeltaTime()/1e3,o=n.camera.position.y<=0;if(d!==o&&(d=o,n.audioDiver.stop(),n.audioOcean.stop(),(d?n.audioDiver:n.audioOcean).play()),h++%8&&(t.depth=d?(-n.camera.position.y).toFixed(1):0,t.time=e,t.ascentSpeed=(n.camera.position.y-n.lastDepth)/r,t.orientationDegrees=180*n.camera.rotation.y/Math.PI,t.fps=n.engine.getFps().toFixed()),n.lastDepth=n.camera.position.y,t.$route.query.debug){var f=document.getElementById("inspector-host");f&&(f.style.position="absolute")}if(n.causticMaterial&&n.causticMaterial.setFloat("time",e),n.rttMaterials.forEach((function(t){t.setFloat("time",e)})),c.update(r),n.scene.render(),t.snapshotRequested){t.snapshotRequested=!1;var m=document.getElementById("underwater-3d").toDataURL(),v={title:"Laje de Santos",url:m},y=function(){var a=document.createElement("a"),e=(new Date).toJSON().slice(0,19).replaceAll(":","-");a.setAttribute("download","LajeDeSantos-"+e+".png"),a.setAttribute("href",m.replace("image/png","application/octet-stream")),a.click()};"share"in navigator?navigator.share(v).catch(y):y()}})),window.addEventListener("resize",this.resize.bind(this))}return Object(E.a)(e,[{key:"beforeDestroy",value:function(){window.removeEventListener("resize",this.resize.bind(this)),document.onfullscreenchange=null,this.engine.stopRenderLoop(),this.audioDiver&&(this.audioDiver.stop(),this.audioDiver=null),this.audioOcean&&(this.audioOcean.stop(),this.audioOcean=null),this.scene.dispose(),this.scene=null,this.engine=null}},{key:"bootScene",value:function(e){var t=this;function n(){this.loadingUIText="Mergulho na Laje de Santos"}n.prototype.displayLoadingUI=function(){alert(this.loadingUIText)},n.prototype.hideLoadingUI=function(){alert("Loaded!")},this.engine=new C.Engine(e,!0),this.engine.loadingUIText="Mergulho na Laje de Santos",this.scene=new C.Scene(this.engine),this.scene.clearColor=new C.Color3(0,0,0);var r=new C.Vector3(-15.51978616737642,1.3786253122458585,29.13296827068854);"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?this.camera=new C.VirtualJoysticksCamera("Camera",r,this.scene):this.camera=new C.UniversalCamera("Camera",r,this.scene),this.camera.applyGravity=!1,this.camera.speed=.05,this.camera.ellipsoid=new C.Vector3(.5,1,.5),this.camera.keysUp.push("w".charCodeAt(0)),this.camera.keysUp.push("W".charCodeAt(0)),this.scene.onKeyboardObservable.add((function(e){switch(C.Engine.audioEngine.audioContext&&C.Engine.audioEngine.audioContext.resume(),e.type){case C.KeyboardEventTypes.KEYDOWN:console.log("KEY DOWN: ",e.event.key);break;case C.KeyboardEventTypes.KEYUP:console.log("KEY UP: ",e.event.keyCode)}})),this.camera.minZ=.1,this.camera.maxZ=700,this.camera.setTarget(new C.Vector3(-12.89001753167552,1.708562384403646,25.710433418293825)),this.camera.attachControl(e,!0),this.camera.inputs.attached.virtualJoystick&&this.camera.inputs.attached.virtualJoystick._rightjoystick.setJoystickSensibility(.01),this.scene.collisionsEnabled=!0,this.camera.checkCollisions=!0,this.scene.autoClear=!1,this.scene.autoClearDepthAndStencil=!1,this.assetsManager=new C.AssetsManager(this.scene),this.assetsManager.onTaskErrorObservable.add((function(e){console.error("task failed",e.name,e.errorObject.message,e.errorObject.exception)})),this.assetsManager.onTaskSuccessObservable.add((function(e){console.log("task successful",e.name)})),this.assetsManager.onProgress=function(e,n,r){t.engine.loadingUIText="We are loading the scene. "+e+" out of "+n+" items still need to be loaded."}}},{key:"sceneOptimizer",value:function(){var e=C.SceneOptimizerOptions.HighDegradationAllowed();e.optimizations=e.optimizations.filter((function(e){return!e.getDescription().includes("Merging similar meshes")}));C.SceneOptimizer.OptimizeAsync(this.scene,e)}},{key:"debugUtils",value:function(){this.scene.debugLayer.show()}},{key:"instrumentation",value:function(){var e=new C.EngineInstrumentation(this.engine);e.captureGPUFrameTime=!0,e.captureShaderCompilationTime=!0;var i=0;this.scene.registerBeforeRender((function(){i%30==0&&console.log("current frame time (GPU): "+(1e-6*e.gpuFrameTimeCounter.current).toFixed(2)+"ms\naverage frame time (GPU): "+(1e-6*e.gpuFrameTimeCounter.average).toFixed(2)+"ms\ntotal shader compilation time: "+e.shaderCompilationTimeCounter.total.toFixed(2)+"ms\naverage shader compilation time: "+e.shaderCompilationTimeCounter.average.toFixed(2)+"ms\ncompiler shaders count: "+e.shaderCompilationTimeCounter.count),i++}))}},{key:"resize",value:function(){this.engine.resize(),this.rebuildOceanTexture=!0}},{key:"lights",value:function(){var e=new C.HemisphericLight("light1",new C.Vector3(0,1,0),this.scene);e.diffuse=C.Color3.FromHexString("#CCCCCC"),e.intensity=.4,this.sunLight=new C.DirectionalLight("DirectionalLight",new C.Vector3(-.5,-1,.6).normalize(),this.scene),this.sunLight.diffuse=C.Color3.FromHexString("#FFFFFF"),this.sunLight.intensity=.8}},{key:"getCausticMaterial",value:function(){var e=this.causticMaterial.clone();return e.freeze(),this.rttMaterials.push(e),e}},{key:"getCausticBlackMaterial",value:function(){var e=this.causticBlackMaterial.clone();return e.freeze(),this.rttMaterials.push(e),e}},{key:"materials",value:function(){C.Effect.ShadersStore.causticVertexShader=F.default,C.Effect.ShadersStore.causticFragmentShader=L.default,C.Effect.ShadersStore.causticblackVertexShader=V.default,C.Effect.ShadersStore.causticblackFragmentShader=B.default,this.causticMaterial=new C.ShaderMaterial("caustic material",this.scene,"caustic",{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection","time","direction"]}),this.causticMaterial.freeze(),this.causticBlackMaterial=new C.ShaderMaterial("caustic black material",this.scene,"causticblack",{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection","time","direction"]}),this.causticBlackMaterial.freeze()}},{key:"composer",value:function(){var e=this;C.Effect.ShadersStore.underwaterVertexShader=D.default,C.Effect.ShadersStore.underwaterFragmentShader=R.default;var t=this.scene.enableDepthRenderer(),n=new C.PassPostProcess("imagePass",1,null,C.Texture.NEAREST_SAMPLINGMODE,this.engine);n.clearColor=new C.Color4(0,0,0,0),this.renderTargetCaustic=new C.RenderTargetTexture("caustic",1024,this.scene),this.scene.customRenderTargets.push(this.renderTargetCaustic),this.setRTTMaterials();var r=new C.PostProcess("Underwater pass","underwater",["fogColor","cameraMinMaxZ","cameraPosition","time"],["skyTexture","depthTexture","causticTexture","oceanDepthTexture"],1,null,0,this.engine),o=new C.PostProcessRenderPipeline(this.engine,"pipeline"),c=new C.Texture(this.base+"textures/half_kloofendal_48d_partly_cloudy_4k.jpg",this.scene,!1,!0,C.Texture.NEAREST_NEAREST),l=this.loadOceanPP();this.oceanPostProcess=l;var d=null;l.onApplyObservable.add((function(t){if(e.rebuildOceanTexture){e.rebuildOceanTexture=!1;var n=r.inputTexture;d&&d.dispose(),(d=n.createDepthStencilTexture(void 0,void 0,e.engine.isStencilEnable)).name="underwaterDepthStencil"}e.engine.setDepthBuffer(!0),e.engine.setDepthWrite(!0),e.engine.clear(null,!1,!0,!1)})),r.onApplyObservable.add((function(e){e._bindTexture("oceanDepthTexture",d)})),this.oceanPostProcess.skyTexture=c;var h=new Date;r.onApply=function(n){var r=(new Date-h)/1e3;n.setColor3("fogColor",new C.Color3(0,.5,.85)),n.setFloat2("cameraMinMaxZ",e.camera.minZ,e.camera.maxZ),n.setFloat("time",r),n.setTexture("causticTexture",e.renderTargetCaustic),n.setTexture("depthTexture",t.getDepthMap()),n.setTexture("skyTexture",c),n.setVector3("cameraPosition",e.camera.position)};var f=new C.FxaaPostProcess("fxaa",1,null,null,this.engine),m=[n,l,r,f],v=new C.PostProcessRenderEffect(this.engine,"renderLayer",(function(){return m}));o.addEffect(v),this.scene.postProcessRenderPipelineManager.addPipeline(o),this.scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline("pipeline",this.camera)}},{key:"loadOceanPP",value:function(){var e=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},t={width:e(this.camera.getEngine().getRenderWidth()),height:e(this.camera.getEngine().getRenderHeight()),light:this.sunLight};t.width>2048&&(t.width=2048),t.height>2048&&(t.height=2048),t.isPipeline=!0;var n=new A.a("myOcean",this.camera,t);return n.reflectionEnabled=!1,n.refractionEnabled=!1,n.autoClear=!1,n.worldScale=.2,n}},{key:"setRTTMaterialsSlow",value:function(){var e=this;this.renderTargetCaustic.onBeforeRender=function(){for(var i in e.renderTargetCaustic.renderList)e.renderTargetCaustic.renderList[i]._saved=e.renderTargetCaustic.renderList[i].material,e.renderTargetCaustic.renderList[i].material=e.renderTargetCaustic.renderList[i].rttMaterial},this.renderTargetCaustic.onAfterRender=function(){for(var i in e.renderTargetCaustic.renderList)e.renderTargetCaustic.renderList[i].material=e.renderTargetCaustic.renderList[i]._saved}}},{key:"setRTTMaterials",value:function(){var e=this;this.renderTargetCaustic.onBeforeRender=function(t){e.renderTargetCaustic.renderList.forEach((function(e){if("InstancedMesh"!==e.getClassName()){if(e.material&&!e.isFrozen&&"isReady"in e&&e.isReady(!0)){var t=[];e.subMeshes.forEach((function(e){t.push([e.effect,e._materialDefines])})),e.isFrozen=!0,e.material.freeze(),e._saved_orig_material=e.material,e._origSubMeshEffects=t}if(e._origSubMeshEffects&&(e.material=e.rttMaterial,e._rtt_subMeshEffects))for(var s=0;s<e.subMeshes.length;++s){var n;(n=e.subMeshes[s]).setEffect.apply(n,T(e._rtt_subMeshEffects[s]))}}}))},this.renderTargetCaustic.onAfterRender=function(){e.renderTargetCaustic.renderList.forEach((function(e){if("InstancedMesh"!==e.getClassName()&&e._origSubMeshEffects){e._rtt_subMeshEffects||(e._rtt_subMeshEffects=[],e.subMeshes.forEach((function(t){e._rtt_subMeshEffects.push([t.effect,t._materialDefines])}))),e.material=e._saved_orig_material;for(var s=0;s<e.subMeshes.length;++s){var t;(t=e.subMeshes[s]).setEffect.apply(t,T(e._origSubMeshEffects[s]))}}}))}}},{key:"addToSceneAndCaustic",value:function(e){var t=this,n=this.getCausticMaterial();return e.forEach((function(e){e.rttMaterial=n,t.renderTargetCaustic.renderList.push(e)})),n}},{key:"loadTerrain",value:function(){var e=this;return new Promise((function(t,n){var r=[],o=[],c=[],l=[],d=null,h=!1,f=function(){if(d&&h&&r.length){r[1].thinInstanceSetBuffer("matrix",d,16);e.addToSceneAndCaustic([r[1]]);t()}};e.assetsManager.addMeshTask("rocks",null,e.base+"models/ilha/","rocks.glb").onSuccess=function(e){e.loadedMeshes.forEach((function(e){"rockLow1"!==e.name&&"rockLow1.001"!==e.name&&"rockLow1.002"!==e.name||(e.freezeNormals(),e.freezeWorldMatrix(),e.material,r.push(e))})),f()},e.assetsManager.addTextFileTask("rocksMatrices",e.base+"models/ilha/rocks.base64").onSuccess=function(e){d=new Float32Array(C.DecodeBase64ToBinary(e.text)),f()},e.assetsManager.addMeshTask("terrain",null,e.base+"models/ilha/","ilha03.glb").onSuccess=function(t){var n,r=[],d=k(t.loadedMeshes);try{for(d.s();!(n=d.n()).done;){var m=n.value;m.name.includes("rock")?(m.computeWorldMatrix(),o.push(m.getAbsolutePivotPoint()),c.push(m.rotationQuaternion),l.push(m.absoluteScaling),m.dispose()):m.freeze&&(m.doNotSyncBoundingInfo=!0,m.material&&m.material.freeze(),m.alwaysSelectAsActiveMesh=!0,m.cullingStrategy=C.AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,m.convertToUnIndexedMesh(),m.freezeNormals(),m.freezeWorldMatrix(),m.freeze(),m.bakeCurrentTransformIntoVertices(),r.push(m),e.sunLight.includedOnlyMeshes.push(m))}}catch(e){d.e(e)}finally{d.f()}e.addToSceneAndCaustic(r),C.Mesh.MergeMeshes(r,!0,!0,void 0,!1,!0);h=!0,f()}}))}},{key:"loadMoreiaBarco",value:function(){var e=this;return new Promise((function(t,n){e.assetsManager.addMeshTask("barcoMoreia",null,e.base+"models/","moreia-20210912.glb").onSuccess=function(n){var r,o=[],c=k(n.loadedMeshes);try{for(c.s();!(r=c.n()).done;){var l=r.value;l.position=new C.Vector3(-14.12,-17.2,27.19),l.material&&(l.material.backFaceCulling=!1,l.material.freeze(),o.push(l)),l.alwaysSelectAsActiveMesh=!0,l.cullingStrategy=C.AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,l.freezeNormals(),l.freezeWorldMatrix()}}catch(e){c.e(e)}finally{c.f()}e.addToSceneAndCaustic(o),t()}}))}},{key:"loadAudio",value:function(){var e=this;return new Promise((function(t,n){var r=function(){e.audioDiver&&e.audioOcean&&t()};e.assetsManager.addBinaryFileTask("sound_diver",e.base+"audio/156011__hdvideoguy__scubadiving-01.mp3").onSuccess=function(t){r(),e.audioDiver=new C.Sound("sound_diver",t.data,e.scene,(function(){}),{autoplay:!1,loop:!0})},e.assetsManager.addBinaryFileTask("sound_ocean",e.base+"audio/435668__byjoshberry__ocean-waves-hitting-bow-of-moving-boat.mp3").onSuccess=function(t){r(),e.audioOcean=new C.Sound("sound_ocean",t.data,e.scene,(function(){e.audioOcean.play()}),{autoplay:!1,loop:!0})}}))}},{key:"loadDiverBoat",value:function(){var e=this;return new Promise((function(t,n){e.assetsManager.addMeshTask("diver_with_boat",null,e.base+"models/","diver_with_boat.glb").onSuccess=function(e){var n,r=k(e.loadedMeshes);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.position=new C.Vector3(-14.12,.5,27.19),o.material&&o.material.freeze(),o.alwaysSelectAsActiveMesh=!0}}catch(e){r.e(e)}finally{r.f()}t()}}))}},{key:"loadFlock",value:function(e,t,n,r,o){var c=this,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=new C.Vector3(0,0,0),h=new O.a(n,d,1,30);h.cohesion=.01,h.alignment=.3,h.separationMinDistance=.1,h.maxSpeed=1,h.addForce((function(e,t){return d.subtract(t.position).scale(5.4)})),h.addForce((function(e,t){var n=c.camera.position.subtract(t.position);return n.lengthSquared<9?new C.Vector3(3,3,3).subtract(n).scale(100):d}));var f=null,m=new Float32Array(16*n),v=new Float32Array(4*n),p=C.SceneLoader.ImportMeshAsync("",e,t,this.scene,void 0);return p.then((function(e){var t,d=e.meshes,h=l?c.getCausticMaterial():null,y=k(d);try{for(y.s();!(t=y.n()).done;){var w=t.value;w.position=r,w.scaling=new C.Vector3(10,10,10),w.material,w.alwaysSelectAsActiveMesh=!0,w.freezeNormals()}}catch(e){y.e(e)}finally{y.f()}f=d[1],h&&(f.rttMaterial=h,c.renderTargetCaustic.renderList.push(f));for(var i=0;i<n;i++){var x=C.Matrix.Translation(c.random(-1,1),0,0);m.set(x.toArray(),16*i)}f.thinInstanceSetBuffer("matrix",m,16);var M=new C.VertexAnimationBaker(c.scene,f);M.bakeVertexData(o).then((function(e){var t=M.textureFromBakedVertexData(e),r=new C.BakedVertexAnimationManager(c.scene);r.texture=t,f.bakedVertexAnimationManager=r;for(var l=0;l<n;l++){var d=C.Matrix.Translation(c.random(-1,1),c.random(-1,1),c.random(-1,1));m.set(d.toArray(),16*l);var h=new C.Vector4(o[0].from,o[0].to,Math.floor(Math.random()*(o[0].from-o[0].to)),30);v.set(h.asArray(),4*l)}f.thinInstanceSetBuffer("matrix",m,16),f.thinInstanceSetBuffer("bakedVertexAnimationSettingsInstanced",v,4)}))})).catch((function(e){console.error(e)})),{models:[f],boidsManager:h,promise:p,update:function(e,t,n){return function(t){if(f&&f.bakedVertexAnimationManager){f.bakedVertexAnimationManager.time+=t,e.update(t);for(var i=0;i<n;i++){var r=e.boids[i],o=C.Matrix.Compose(new C.Vector3(1,1,1),new C.Quaternion(r.velocity.x,r.velocity.y,r.velocity.z,0),r.position);m.set(o.toArray(),16*i)}}}}(h,0,n)}}},{key:"random",value:function(e,t){return Math.random()*(t-e)+e}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(e,t),n)}}]),e}(),N={props:{},data:function(){return{isFullscreen:!1,snapshotRequested:!1,ascentSpeed:0,depth:0,time:0,air:100,fps:0,volume:0,mute:!1,orientationDegrees:0}},computed:{base:function(){return this.$router.options.base},ascentSpeedColor:function(){return this.ascentSpeed<1/60?"#000":this.ascentSpeed<.1||this.ascentSpeed<.2?"#0f0":this.ascentSpeed<.3?"#ff0":"#f00"},ascentSpeedGraph:function(){return 0===this.depth?"":this.ascentSpeed<1/60||this.ascentSpeed<.1?"<":this.ascentSpeed<.2?"<<":this.ascentSpeed<.3?"<<<":"<<<<"}},mounted:function(){this.underwater=new I(this),window.underwater=this.underwater},methods:{fullscreen:function(){document.getElementById("underwater").requestFullscreen()},toggleVolume:function(){this.mute=!this.mute,this.mute?(this.volume=C.Engine.audioEngine.getGlobalVolume(),C.Engine.audioEngine.setGlobalVolume(0)):C.Engine.audioEngine.setGlobalVolume(this.volume)}}},z=(n(336),n(4)),j={components:{Underwater:Object(z.a)(N,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"underwater"}},[n("button",{directives:[{name:"show",rawName:"v-show",value:!e.isFullscreen,expression:"!isFullscreen"}],attrs:{id:"underwater-out"},on:{click:e.fullscreen}},[n("i18n",[e._v("Ficar em tela cheia")])],1),e._v(" "),n("canvas",{attrs:{id:"underwater-3d","touch-action":"none"}}),e._v(" "),n("div",{attrs:{id:"underwater-debug"}},[e._v("\n    "+e._s(e.fps)+" fps\n  ")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:!e.isFullscreen,expression:"!isFullscreen"}],attrs:{id:"underwater-fullscreen"},on:{click:e.fullscreen}},[n("i18n",[e._v("Ficar em tela cheia")])],1),e._v(" "),n("div",{attrs:{id:"underwater-hud"}},[n("div",{attrs:{id:"underwater-hud-depth"}},[n("span",{attrs:{id:"underwater-hud-depth-name"}},[n("i18n",[e._v("Profundidade")])],1),n("br"),e._v(" "),n("span",{style:{color:e.ascentSpeedColor},attrs:{id:"underwater-hud-depth-ascent"}},[e._v(e._s(e.ascentSpeedGraph))]),e._v(" "),n("span",{attrs:{id:"underwater-hud-depth-value"}},[e._v(e._s(e.depth))]),e._v(" "),n("span",{attrs:{id:"underwater-hud-depth-unit"}},[e._v("m")])]),e._v(" "),n("div",{attrs:{id:"underwater-hud-time"}},[n("span",{attrs:{id:"underwater-hud-time-name"}},[n("i18n",[e._v("Tempo")])],1),n("br"),e._v(" "),n("span",{attrs:{id:"underwater-hud-time-value"}},[e._v(e._s(parseInt(e.time/60,10))+":"+e._s(parseInt(e.time%60,10).toString().padStart(2,"0")))])]),e._v(" "),n("div",{attrs:{id:"underwater-hud-compass"}},[n("span",{attrs:{id:"underwater-hud-compass-name"}},[n("i18n",[e._v("Compasso")])],1),n("br"),e._v(" "),n("span",{attrs:{id:"underwater-hud-compass-value"}},[e._v(e._s((parseInt(e.orientationDegrees)%360+360)%360))])])]),e._v(" "),n("div",{attrs:{id:"underwater-settings"}},[n("font-awesome-icon",{attrs:{icon:["fas","camera"],size:"2x"},on:{click:function(t){e.snapshotRequested=!0}}}),e._v(" "),n("font-awesome-layers",{staticClass:"fa-2x",on:{click:e.toggleVolume}},[n("font-awesome-icon",{attrs:{icon:["fas","volume-up"],transform:"shrink-6"}}),e._v(" "),n("font-awesome-icon",{directives:[{name:"show",rawName:"v-show",value:e.mute,expression:"mute"}],staticStyle:{color:"Tomato"},attrs:{icon:"ban"}})],1)],1)])}),[],!1,null,"d43b8708",null).exports},extends:w.default,data:function(){return{gpuTierLoaded:!1,gpuTier:{tier:-1,isMobile:!1,type:"",fps:0,gpu:""}}},mounted:function(){this.head.title=this.$gettext("Mergulho virtual"),this.head.description=this.$gettext("Mergulho em realidade virtual na Laje de Santos"),this.getGpuTier()},methods:{getGpuTier:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y();case 2:n=t.sent,e.$set(e,"gpuTier",n),e.gpuTierLoaded=!0;case 5:case"end":return t.stop()}}),t)})))()}}},U=Object(z.a)(j,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("article",[n("section",[n("h1",[n("i18n",[e._v("Mergulho virtual")])],1),e._v(" "),n("p",[n("i18n",[e._v("\n        Experimente um mergulho virtual na Laje de Santos e veja o naufrágio Moreia e a vida.\n        É preciso que seu aparelho tenha suporte a 3D para executar este ambiente com bom\n        desempenho. Expectativa de desempenho:\n      ")]),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:!e.gpuTierLoaded,expression:"!gpuTierLoaded"}]},[n("i18n",[e._v("Testando desempenho...")])],1),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.gpuTierLoaded,expression:"gpuTierLoaded"}],staticStyle:{"font-weight":"bold"}},[0===e.gpuTier.tier?n("span",[n("i18n",[e._v("Muito baixo desempenho, muito devagar ou não funcionará")])],1):1===e.gpuTier.tier?n("span",[n("i18n",[e._v("Baixo desempenho, devagar")])],1):2===e.gpuTier.tier?n("span",[n("i18n",[e._v("Médio desempenho")])],1):3===e.gpuTier.tier?n("span",[n("i18n",[e._v("Ótimo desempenho")])],1):e._e()])],1),e._v(" "),n("Underwater")],1)])}),[],!1,null,null,null);t.default=U.exports}}]);