(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{179:function(e,t,n){var content=n(198);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(14).default)("5b9b605c",content,!0,{sourceMap:!1})},197:function(e,t,n){"use strict";var o=n(179);n.n(o).a},198:function(e,t,n){var o=n(13);(e.exports=o(!1)).push([e.i,"#underwater{position:relative}#underwater,#underwater-3d{height:100vh;width:100vw}#underwater-debug{top:0;right:0}#underwater-debug,#underwater-hud{position:absolute;padding:10px;z-index:1000;border-radius:10px;background:#000;font-family:Oxygen,monospace;color:#fff;text-align:right}#underwater-hud{bottom:0;left:0;width:160px;height:200px;font-size:64px}#inspector-host .label,#sceneExplorer .label{color:#fff;font-weight:400;font-size:14px}#inspector-host .title,#sceneExplorer .title{color:#fff;font-weight:400;font-size:14px;line-height:normal;font-family:Arial;line-height:1}",""])},245:function(e,t,n){"use strict";n.r(t);n(73),n(39),n(28);var o=n(174);n(193),n(194);class r{constructor(e,t,n){this.id=e,this.position=t,this.velocity=n,this.force=new BABYLON.Vector3(0,0,0)}get orientation(){return this.velocity.normalize()}}var d=class{constructor(e,t,n=1,o=100,d=null){this.cohesion=.3,this.separation=.4,this.alignment=1,this.separationMinDistance=3,this.maxSpeed=1,this.boundsMin=new BABYLON.Vector3(t.x-o,t.y-o,t.z-o),this.boundsMax=new BABYLON.Vector3(t.x+o,t.y+o,t.z+o),this.otherForces=[],this.boids=[],this.debug={show:!1,influences:[],arrows:[]},d||(d=new BABYLON.Vector3(.3,.1,.3));const c=d.length();this.center=t.clone(),this.avgVel=new BABYLON.Vector3(0,0,0);for(let i=0;i<e;i++){const e=this.center.add(new BABYLON.Vector3((Math.random()-.5)*n,(Math.random()-.5)*n,(Math.random()-.5)*n)),t=new BABYLON.Vector3(d.x+(Math.random()-.5)/10*c,d.y+(Math.random()-.5)/10*c,d.z+(Math.random()-.5)/10*c),o=new r(i,e,t);this.boids.push(o)}}update(e){this._updateCenter();const t=this.maxSpeed*this.maxSpeed;this.boids.forEach(n=>{const o=this._forceCentreMass(n),r=this._forceSeparation(n),d=this._forceMatchVelocity(n),c=this._forceBoundaries(n),h=o.add(r).add(d).add(c);this.otherForces.forEach(e=>{h.add(e(this,n))}),n.force.copyFrom(h),n.velocity.addInPlace(h.scale(e)),n.velocity.lengthSquared()>t&&(n.velocity=n.velocity.normalize().scale(this.maxSpeed)),n.position.addInPlace(n.velocity.scale(e))}),this._updateDebug()}_updateCenter(){if(!this.boids.length)return;const e=new BABYLON.Vector3(0,0,0),t=new BABYLON.Vector3(0,0,0);this.boids.forEach(n=>{e.addInPlace(n.position),t.addInPlace(n.velocity)}),e.scaleInPlace(1/this.boids.length),t.scaleInPlace(1/this.boids.length),this.center=e,this.avgVel=t}_forceCentreMass(e){return this.center.subtract(e.position).scale(this.cohesion)}_forceSeparation(e){const t=new BABYLON.Vector3(0,0,0);return this.boids.forEach(n=>{if(e.id===n.id)return;const o=e.position.subtract(n.position),r=o.length();r<this.separationMinDistance&&t.addInPlace(o.scale(this.separationMinDistance-r))}),t.scale(this.separation)}_forceMatchVelocity(e){return this.avgVel.subtract(e.velocity).scale(this.alignment)}_forceBoundaries(e){const t=new BABYLON.Vector3(0,0,0);return e.position.x<.9*this.boundsMin.x?t.x=.2:e.position.x>.9*this.boundsMax.x&&(t.x=-.2),e.position.y<.9*this.boundsMin.y?t.y=.2:e.position.y>.9*this.boundsMax.y&&(t.y=-.2),e.position.z<.9*this.boundsMin.z?t.z=.2:e.position.z>.9*this.boundsMax.z&&(t.z=-.2),t}addForce(e){this.otherForces.push(e)}showDebug(e){if(this.debug.show)return;const t=new BABYLON.StandardMaterial("debug_center",e);t.diffuseColor=BABYLON.Color3.FromHexString("#FF0000"),this.debug.center=BABYLON.MeshBuilder.CreateSphere("center",{diameter:.1,segments:8});const n=new BABYLON.StandardMaterial("debug_bbox",e);n.diffuseColor=BABYLON.Color3.FromHexString("#00FF00"),n.wireframe=!0,this.debug.center.material=t,this.debug.bbox=BABYLON.Mesh.CreateBox("boids_bbox",1,e),this.debug.bbox.scaling.x=Math.abs(this.boundsMax.x-this.boundsMin.x),this.debug.bbox.scaling.y=Math.abs(this.boundsMax.y-this.boundsMin.y),this.debug.bbox.scaling.z=Math.abs(this.boundsMax.z-this.boundsMin.z),this.debug.bbox.position.x=Math.abs(this.boundsMax.x-this.boundsMin.x)/2,this.debug.bbox.position.y=Math.abs(this.boundsMax.y-this.boundsMin.y)/2,this.debug.bbox.position.z=Math.abs(this.boundsMax.z-this.boundsMin.z)/2,this.debug.bbox.material=n;const o=new BABYLON.StandardMaterial("debug_wireframe",e);o.diffuseColor=BABYLON.Color3.FromHexString("#FFFFFF"),o.wireframe=!0;for(const t of this.boids)t.debug={},t.debug.force=BABYLON.MeshBuilder.CreateTube(`boid_arrow_${t.uniqueId}`,{path:[t.position.add(t.velocity),t.position.clone()],radius:.01,updatable:!0},e),t.debug.influence=BABYLON.MeshBuilder.CreateSphere(`boid_influence_${t.uniqueId}`,{diameter:1,segments:8}),t.debug.influence.scaling.setAll(this.separationMinDistance),t.debug.influence.material=o;this.debug.show=!0}hideDebug(e){this.debug.show=!1,this.debug.center=void 0;for(const e of this.boids)e.debug&&(e.debug.force.dispose(),e.debug.influence.dispose(),e.debug={})}_updateDebug(){if(this.debug.show){this.debug.center.position.copyFrom(this.center);for(const e of this.boids){const path=[e.position.add(e.force.scale(20)),e.position.clone()];e.debug.force=BABYLON.MeshBuilder.CreateTube(e.debug.force.name,{path:path,radius:.01,instance:e.debug.force}),e.debug.influence.position.copyFrom(e.position)}}}gui(e){const{GUI:t}=BABYLON,n=t.AdvancedDynamicTexture.CreateFullscreenUI("UI",void 0,void 0,e),o=new t.StackPanel;o.width="220px",o.horizontalAlignment=t.Control.HORIZONTAL_ALIGNMENT_RIGHT,o.verticalAlignment=t.Control.VERTICAL_ALIGNMENT_CENTER,n.addControl(o);const r=(e,n=4,r=(()=>{}))=>{const header=new t.TextBlock;header.text=`${e} ${this[e]}`,header.height="30px",header.color="white",o.addControl(header);const d=new t.Slider;d.minimum=0,d.maximum=n,d.value=this[e],d.height="20px",d.width="200px";const c=function(e,header,t){return n=>{e[t]=n,header.text=`${t} ${n}`,r.apply(e)}}(this,header,e);d.onValueChangedObservable.add(c),o.addControl(d)};r("cohesion",1.5),r("separation"),r("alignment"),r("separationMinDistance",50,e=>{this.debug.center&&this.boids.forEach(e=>{e.debug.influence.scaling.setAll(this.separationMinDistance)})});const header=new t.TextBlock;header.text="show debug helpers",header.height="30px",header.color="white",o.addControl(header);const d=new t.Checkbox;d.width="20px",d.height="20px",d.isChecked=this.debug.show,d.color="green",d.onIsCheckedChangedObservable.add(t=>{t?this.showDebug(e):this.hideDebug(e)}),o.addControl(d)}},c={props:{},data:function(){return{engine:null,scene:null,camera:null,assetsManager:null}},mounted:function(){var e=this,t=document.getElementById("underwater-3d");this.bootScene(t),this.lights();var n=this.loadFishFlock("./models/borboleta/","borboleta.glb",20);this.engine.runRenderLoop((function(){var t=e.engine.getDeltaTime()/1e3,o=document.getElementById("inspector-host");o&&(o.style.position="absolute"),n.update(t),e.scene.render()})),window.addEventListener("resize",this.resize)},beforeDestroy:function(){window.removeEventListener("resize",this.resize),this.engine.stopRenderLoop(),this.scene.dispose(),this.scene=null,this.engine=null},methods:{bootScene:function(e){function t(){this.loadingUIText="Mergulho na Laje de Santos"}t.prototype.displayLoadingUI=function(){alert(this.loadingUIText)},t.prototype.hideLoadingUI=function(){alert("Loaded!")},this.engine=new o.Engine(e,!0),this.engine.loadingUIText="BoidsTest",this.scene=new o.Scene(this.engine),this.camera=new o.UniversalCamera("Camera",new o.Vector3(10,10,10),this.scene),this.camera.setTarget(new o.Vector3(0,0,0)),this.camera.applyGravity=!1,this.camera.speed=.1,this.camera.ellipsoid=new o.Vector3(.5,1,.5),this.camera.keysUp.push("w".charCodeAt(0)),this.camera.keysUp.push("W".charCodeAt(0)),this.camera.minZ=.1,this.camera.maxZ=1e3,this.camera.attachControl(e,!0),this.scene.collisionsEnabled=!0,this.camera.checkCollisions=!0},debugUtils:function(){this.scene.debugLayer.show(),document.querySelector("footer.footer").style.display="none"},resize:function(){this.engine.resize()},lights:function(){var e=new o.HemisphericLight("light1",new o.Vector3(1,1,0),this.scene);e.diffuse=o.Color3.FromHexString("#CCCCCC"),e.intensity=.4,new o.DirectionalLight("DirectionalLight",new o.Vector3(.2,-1,0),this.scene).diffuse=o.Color3.FromHexString("#FFFFFF"),e.intensity=.8},loadCubes:function(e){var t,n,r=new d(e,new o.Vector3(0,0,0),10,10),c=[],h=new o.StandardMaterial("brickMaterial",this.scene);h.diffuseTexture=new o.Texture("/brick_diffuse.jpg",this.scene);for(var i=0;i<e;i++){var l=o.MeshBuilder.CreateBox("box"+i,{width:.3,height:.5,depth:1});l.boid=r.boids[i],l.material=h,c.push(l)}return r.showDebug(),r.gui(this.scene),{models:c,boids:r,update:(t=r,n=c,function(e){t.update(e),n.forEach((function(e){e.position.copyFrom(e.boid.position),e.setDirection(e.boid.orientation)}))})}},loadFishFlock:function(e,t,n){var r,c,h=new d(n,new o.Vector3(0,10,0),50),l=[];return n=3,o.SceneLoader.LoadAssetContainer(e,t,this.scene,(function(e){e.addAllToScene(),e.meshes.forEach((function(e){e.scaling.set(5,5,5),e.setEnabled(!1),e.material&&e.material.freeze()}));for(var t=function(i){var t=e.instantiateModelsToScene((function(p){return"fish"+p+i})),n=!0,o=!1,r=void 0;try{for(var d,c=t.rootNodes[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){d.value.position.set(h.boids[i].position)}}catch(e){o=!0,r=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw r}}t.animationGroups&&(t.animationGroups[0].speedRatio=1+.1*(Math.random()-.5),t.animationGroups[0].play(!0)),t.boid=h.boids[i],l.push(t)},i=0;i<n;i++)t(i)})),{models:l,boids:h,update:(r=h,c=l,function(e){r.update(e),c.forEach((function(e){var t=!0,n=!1,o=void 0;try{for(var r,d=e.rootNodes[Symbol.iterator]();!(t=(r=d.next()).done);t=!0){var c=r.value;c.position.copyFrom(e.boid.position),c.setDirection(e.boid.orientation)}}catch(e){n=!0,o=e}finally{try{t||null==d.return||d.return()}finally{if(n)throw o}}}))})}},clamp:function(e,t,n){return Math.min(Math.max(e,t),n)}},head:function(){return{link:[]}}},h=(n(197),n(4)),l={components:{BoidsTest:Object(h.a)(c,(function(){var e=this.$createElement;this._self._c;return this._m(0)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"underwater"}},[t("canvas",{attrs:{id:"underwater-3d","touch-action":"none"}})])}],!1,null,null,null).exports},data:function(){return{}}},f=Object(h.a)(l,(function(){var e=this.$createElement,t=this._self._c||e;return t("article",[t("section",[t("boids-test")],1)])}),[],!1,null,null,null);t.default=f.exports}}]);